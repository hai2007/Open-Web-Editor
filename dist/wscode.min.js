/*!
* web Studio Code - 🎉 An Editor Used on the Browser Side.
* git+https://github.com/yelloxing/Web-Studio-Code.git
*
* author 心叶
*
* version 1.8.0-alpha.1
*
* build Fri May 08 2020
*
* Copyright yelloxing
* Released under the MIT license
*
* Date:Tue Jun 30 2020 16:09:06 GMT+0800 (GMT+08:00)
*/

"use strict";function _toConsumableArray2(e){return _arrayWithoutHoles2(e)||_iterableToArray2(e)||_unsupportedIterableToArray(e)||_nonIterableSpread2()}function _nonIterableSpread2(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}function _iterableToArray2(e){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles2(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}function _defineProperty2(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function _typeof2(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof2=function e(t){return typeof t}}else{_typeof2=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return _typeof2(e)}(function(){"use strict";var e;if(!window.Symbol){window.Symbol=function(){console.error("\n[Web Studio Code] Symbol Unexpected!\n------------------------------------------------------------------\nhttps://github.com/yelloxing/Web-Studio-Code/issues\n\n")}}var t=Object.prototype.toString;function r(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return t.call(e)}function n(e){if(e===null||_typeof2(e)!=="object"||r(e)!="[object Object]"){return false}if(Object.getPrototypeOf(e)===null){return true}var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}function l(e){return e!==null&&_typeof2(e)==="object"&&(e.nodeType===1||e.nodeType===9||e.nodeType===11)&&!n(e)}function _(e){var t=_typeof2(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&r(e)==="[object String]"}function o(e){var t=_typeof2(e);return e!=null&&(t==="object"||t==="function")}function u(e){if(!o(e)){return false}var t=r(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function i(e){this.__helpDOM.innerText=e;return this.__helpDOM.offsetWidth}function a(e,t){if(arguments.length<2)t=t||this.__lineNum;var r=this._contentArray[t];if(e<=40)return 0;if(e-40>=this.$$textWidth(r))return r.length;var n=e-40,o=1;for(;o<r.length;o++){var i=Math.abs(e-40-this.$$textWidth(r.substr(0,o)));if(i>n)break;n=i}return o-1}function c(e,t){return{x:this.$$textWidth(this._contentArray[t].substr(0,e)),y:t*21}}function s(){return this.__cursor1.lineNum!=this.__cursor2.lineNum||this.__cursor1.leftNum!=this.__cursor2.leftNum}function f(e,t){var r=this;var n="",o="";if(t==this.__lineNum){n="background-color:"+this._colorEdit}o+="<div style='min-width: fit-content;white-space: nowrap;line-height:21px;height:21px;"+n+"'>";o+="<em style='color:"+this._colorNumber+";user-select: none;display:inline-block;font-style:normal;width:35px;text-align:right;margin-right:5px;'>"+(t+1)+"</em>";e.forEach(function(e){var t=e.content;t=t.replace(/\&/g,"&amp;");t=t.replace(/</g,"&lt;");t=t.replace(/>/g,"&gt;");o+="<span style='user-select: none;font-weight:"+r._fontWeight+";white-space: pre;color:"+e.color+"'>"+t+"</span>"});return o+"</div>"}var h={stopPropagation:function e(t){t=t||window.event;if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}},preventDefault:function e(t){t=t||window.event;if(t.preventDefault){t.preventDefault()}else{t.returnValue=false}},bind:function e(t,r,n){if(window.attachEvent){t.attachEvent("on"+r,n)}else{t.addEventListener(r,n,false)}},trigger:function e(t,r){var n;if(document.createEventObject){n=document.createEventObject();t.fireEvent("on"+r,n)}else{n=document.createEvent("HTMLEvents");n.initEvent(r,true,false);t.dispatchEvent(n)}},toNode:function e(t){var r=document.createElement("div");r.innerHTML=t;var n=r.childNodes;for(var o=0;o<n.length;o++){if(l(n[o]))return n[o]}return null},appendTo:function e(t,r){var n=l(r)?r:this.toNode(r);t.appendChild(n);return n},remove:function e(t){t.parentNode.removeChild(t)},after:function e(t,r){var n=l(r)?r:this.toNode(r);t.parentNode.insertBefore(n,t.nextSibling);return n},css:function e(t,r){for(var n in r){t.style[n]=r[n]}},attr:function e(t,r){for(var n in r){t.setAttribute(n,r[n])}},position:function e(t,r){r=r||window.event;var n=t.getBoundingClientRect();if(!r||!r.clientX)throw new Error("Event is necessary!");var o={x:r.clientX-n.left+t.scrollLeft,y:r.clientY-n.top+t.scrollTop};return o},copy:function e(t){var r=this.appendTo(document.body,"<textarea>"+t+"</textarea>");r.select();try{var n=window.document.execCommand("copy",false,null);if(n){}else{}}catch(e){console.error(e)}document.body.removeChild(r)}};function p(){var e=this;this._el.innerHTML="";h.css(this._el,{"font-size":"12px",position:"relative",cursor:"text","font-family":this._fontFamily,background:this._colorBackground,overflow:"auto"});h.bind(this._el,"click",function(){setTimeout(function(){e.__focusDOM.focus()})});this.__helpDOM=h.appendTo(this._el,"<span></span>");h.css(this.__helpDOM,{position:"absolute","z-index":"-1","white-space":"pre",top:0,left:0,"font-weight":this._fontWeight});this.__focusDOM=h.appendTo(this._el,"<textarea></textarea>");h.css(this.__focusDOM,{position:"absolute",width:"6px","margin-top":"3px",height:"15px","line-height":"15px",resize:"none",overflow:"hidden",padding:"0",outline:"none",border:"none",background:"rgba(0,0,0,0)",color:this._colorCursor});h.attr(this.__focusDOM,{wrap:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});this.__showDOM=h.appendTo(this._el,"<div></div>");h.css(this.__showDOM,{padding:"10px 0"});this.__selectCanvas=h.appendTo(this._el,"<canvas></canvas>");h.css(this.__selectCanvas,{position:"absolute",left:"40px",top:"10px",opacity:"0.5"});this.$$updateCanvasSize(1,1)}function d(){h.css(this.__focusDOM,{left:40+this.$$textWidth(this._contentArray[this.__lineNum])+"px",top:10+this.__lineNum*21+"px"});this.__focusDOM.focus()}function m(){var r=this;if(this.__diff=="not update")return;if(this.__diff&&this.__diff.beginNum+this.__diff.endNum>10){var e=this.__showDOM.childNodes;for(var t=this.__diff.beginNum;t<e.length-this.__diff.endNum;t++){h.remove(e[t])}if(this.__diff.beginNum>0){for(var n=this.__formatData.length-1-this.__diff.endNum;n>=this.__diff.beginNum;n--){h.after(e[this.__diff.beginNum-1],this.$$toTemplate(this.__formatData[n],n))}}else{for(var o=0;o<this.__formatData.length-this.__diff.endNum;o++){h.appendTo(this.__showDOM,this.$$toTemplate(this.__formatData[o],o))}}}else{var i="";this.__formatData.forEach(function(e,t){i+=r.$$toTemplate(e,t)});this.__showDOM.innerHTML=i}this.__diff="not update"}function g(){var a=this;var l=this.__selectCanvas.getContext("2d");l.fillStyle=this._colorSelect;l.clearRect(0,0,this.__selectCanvas.scrollWidth,this.__selectCanvas.scrollHeight);var e=function e(t,r,n){var o=a.$$calcCanvasXY(t,n);var i=a.$$calcCanvasXY(r,n);l.fillRect(o.x,o.y,i.x-o.x,21)};if(this.__cursor1.lineNum==this.__cursor2.lineNum&&this.__cursor1.leftNum==this.__cursor2.leftNum)return;l.beginPath();if(this.__cursor1.lineNum==this.__cursor2.lineNum){e(this.__cursor1.leftNum,this.__cursor2.leftNum,this.__cursor1.lineNum)}else{var t,r;if(this.__cursor1.lineNum<this.__cursor2.lineNum){t=this.__cursor1;r=this.__cursor2}else{t=this.__cursor2;r=this.__cursor1}e(t.leftNum,this._contentArray[t.lineNum].length,t.lineNum);e(0,r.leftNum,r.lineNum);for(var n=t.lineNum+1;n<r.lineNum;n++){e(0,this._contentArray[n].length,n)}}}function y(){h.css(this.__focusDOM,{top:this.__lineNum*21+10+"px",left:40+this.$$textWidth(this._contentArray[this.__lineNum].substring(0,this.__leftNum))+"px"})}function v(e,t){if(arguments.length<2){e=this._el.scrollWidth-40;t=this._el.scrollHeight-10}h.css(this.__selectCanvas,{width:e+"px",height:t+"px"});h.attr(this.__selectCanvas,{width:e,height:t})}function b(){this.$$updateCanvasSize(1,1);this.__cursor1={leftNum:0,lineNum:0};this.__cursor2={leftNum:0,lineNum:0}}function N(){var e=this.__cursor2,t=this.__cursor1;if(this.__cursor1.lineNum<this.__cursor2.lineNum){e=this.__cursor1;t=this.__cursor2}else if(this.__cursor1.lineNum==this.__cursor2.lineNum){if(this.__cursor1.leftNum<this.__cursor2.leftNum){e=this.__cursor1;t=this.__cursor2}}var r=this._contentArray[e.lineNum].substr(0,e.leftNum)+this._contentArray[t.lineNum].substr(t.leftNum);this._contentArray.splice(e.lineNum,t.lineNum-e.lineNum+1,r);this.__leftNum=this.__cursor1.leftNum=this.__cursor2.leftNum=e.leftNum;this.__lineNum=this.__cursor1.lineNum=this.__cursor2.lineNum=e.lineNum;this.$$cancelSelect()}var $=(e={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear"},_defineProperty2(e,"45","insert"),_defineProperty2(e,19,"pause"),_defineProperty2(e,112,"f1"),_defineProperty2(e,113,"f2"),_defineProperty2(e,114,"f3"),_defineProperty2(e,115,"f4"),_defineProperty2(e,116,"f5"),_defineProperty2(e,117,"f6"),_defineProperty2(e,118,"f7"),_defineProperty2(e,119,"f8"),_defineProperty2(e,120,"f9"),_defineProperty2(e,121,"f10"),_defineProperty2(e,122,"f11"),_defineProperty2(e,123,"f12"),_defineProperty2(e,189,["-","_"]),_defineProperty2(e,187,["=","+"]),_defineProperty2(e,219,["[","{"]),_defineProperty2(e,221,["]","}"]),_defineProperty2(e,220,["\\","|"]),_defineProperty2(e,186,[";",":"]),_defineProperty2(e,222,["'",'"']),_defineProperty2(e,188,[",","<"]),_defineProperty2(e,190,[".",">"]),_defineProperty2(e,191,["/","?"]),_defineProperty2(e,192,["`","~"]),e);var w=["shift","ctrl","alt"];function x(e){e=e||window.event;var t=e.keyCode||e.which;var r=$[t]||t;if(!r)return;if(r.constructor!==Array)r=[r,r];var n=e.shiftKey?"shift+":"",o=e.altKey?"alt+":"",i=e.ctrlKey?"ctrl+":"";var a="",l=i+n+o;if(w.indexOf(r[0])>=0){r[0]=r[1]=""}var u=e.code=="Key"+e.key&&!n;a=l+(l==""&&u?r[1]:r[0]);if(r[0]==""){a=a.replace(/\+$/,"")}return a}function A(){var a=this;var t=false;var r=function e(t){var r=h.position(a._el,t);var n=Math.round((r.y-20.5)/21);if(n<0)n=0;if(n>=a._contentArray.length)n=a._contentArray.length-1;return{leftNum:a.$$bestLeftNum(r.x,n),lineNum:n}};var l=function e(){var t=a.__cursor2,r=a.__cursor1;if(a.__cursor1.lineNum<a.__cursor2.lineNum){t=a.__cursor1;r=a.__cursor2}else if(a.__cursor1.lineNum==a.__cursor2.lineNum){if(a.__cursor1.leftNum<a.__cursor2.leftNum){t=a.__cursor1;r=a.__cursor2}return a._contentArray[t.lineNum].substring(t.leftNum,r.leftNum)}var n="";n+=a._contentArray[t.lineNum].substr(t.leftNum)+"\n";for(var o=t.lineNum+1;o<r.lineNum;o++){n+=a._contentArray[o]+"\n"}n+=a._contentArray[r.lineNum].substr(0,r.leftNum);return n};h.bind(document,"mousedown",function(e){t=true;a.__cursor2=a.__cursor1=r(e);a.$$updateCanvasSize();a.$$updateSelectView()});h.bind(document,"mousemove",function(e){if(!t)return;a.__cursor2=r(e);a.$$updateSelectView()});h.bind(document,"mouseup",function(){return t=false});h.bind(document,"mouseout",function(){return t=false});h.bind(this._el,"click",function(e){var t=h.position(a._el,e);var r=Math.round((t.y-20.5)/21);if(r<0||r>=a._contentArray.length)return;a.__lineNum=r;a.__leftNum=a.$$bestLeftNum(t.x);a.$$updateCursorPosition();a.$$updateView()});var u=function e(t){t=t||a.__focusDOM.value;t=a.$$filterText(t);a.__focusDOM.value="";if(a.$$selectIsNotBlank())a.$$deleteSelect();if(/^\n$/.test(t)){if(a.__leftNum>=a._contentArray[a.__lineNum].length){a._contentArray.splice(a.__lineNum+1,0,"")}else{a._contentArray.splice(a.__lineNum+1,0,a._contentArray[a.__lineNum].substring(a.__leftNum));a._contentArray[a.__lineNum]=a._contentArray[a.__lineNum].substring(0,a.__leftNum)}a.__lineNum+=1;a.__leftNum=0}else{var r=t.split(/\n/);if(r.length<=1){a._contentArray[a.__lineNum]=a._contentArray[a.__lineNum].substring(0,a.__leftNum)+t+a._contentArray[a.__lineNum].substring(a.__leftNum);a.__leftNum+=t.length}else{var n;var o=a._contentArray[a.__lineNum].substring(0,a.__leftNum);var i=a._contentArray[a.__lineNum].substring(a.__leftNum);r[0]=o+r[0];r[r.length-1]+=i;(n=a._contentArray).splice.apply(n,[a.__lineNum,1].concat(_toConsumableArray2(r)));a.__lineNum+=r.length-1;a.__leftNum=r[r.length-1].length-i.length}}a.__formatData=a.$$diff(a.$shader(a._contentArray.join("\n"),a._langColors));a.$$updateCursorPosition();a.$$updateView();a.__updated__()};h.bind(this.__focusDOM,"compositionstart",function(){a.__needUpdate=false;a.__focusDOM.style.color="rgba(0,0,0,0)";a.__focusDOM.style.borderLeft="1px solid "+a._colorCursor});h.bind(this.__focusDOM,"compositionend",function(){a.__needUpdate=true;a.__focusDOM.style.color=a._colorCursor;a.__focusDOM.style.borderLeft="none";u()});h.bind(this.__focusDOM,"input",function(){if(a.__needUpdate)u()});h.bind(this._el,"keydown",function(e){switch(x(e)){case"ctrl+a":{a.__cursor1={leftNum:0,lineNum:0};a.__cursor2={lineNum:a._contentArray.length-1,leftNum:a._contentArray[a._contentArray.length-1].length};a.$$updateSelectView();break}case"ctrl+c":{if(a.$$selectIsNotBlank()){h.copy(l());a.__focusDOM.focus()}break}case"ctrl+x":{if(a.$$selectIsNotBlank()){h.copy(l());a.__focusDOM.focus();a.$$deleteSelect();a.__formatData=a.$$diff(a.$shader(a._contentArray.join("\n"),a._langColors));a.$$updateCursorPosition();a.$$updateView();a.$$cancelSelect();a.__updated__()}break}case"tab":{h.stopPropagation(e);h.preventDefault(e);var t="";for(var r=0;r<a._tabSpace;r++){t+=" "}if(a.$$selectIsNotBlank()){var n=a.__cursor1.lineNum,o=a.__cursor2.lineNum;if(n>o){n=a.__cursor2.lineNum;o=a.__cursor1.lineNum}for(var i=n;i<=o;i++){a._contentArray[i]=t+a._contentArray[i]}a.__cursor1.leftNum+=a._tabSpace;a.__cursor2.leftNum+=a._tabSpace;a.__leftNum+=a._tabSpace;a.__formatData=a.$$diff(a.$shader(a._contentArray.join("\n"),a._langColors));a.$$updateCursorPosition();a.$$updateView();a.$$updateCanvasSize();a.$$updateSelectView();a.__updated__()}else{u(t)}break}case"up":{if(a.__lineNum<=0)return;a.__lineNum-=1;a.__leftNum=a.$$bestLeftNum(a.$$textWidth(a._contentArray[a.__lineNum+1].substr(0,a.__leftNum))+40);a.$$updateCursorPosition();a.$$updateView();a.$$cancelSelect();a._el.scrollTop-=21;break}case"down":{if(a.__lineNum>=a._contentArray.length-1)return;a.__lineNum+=1;a.__leftNum=a.$$bestLeftNum(a.$$textWidth(a._contentArray[a.__lineNum-1].substr(0,a.__leftNum))+40);a.$$updateCursorPosition();a.$$updateView();a.$$cancelSelect();a._el.scrollTop+=21;break}case"left":{if(a.__leftNum<=0){if(a.__lineNum<=0)return;a.__lineNum-=1;a.__leftNum=a._contentArray[a.__lineNum].length}else{a.__leftNum-=1}a.$$updateCursorPosition();a.$$cancelSelect();break}case"right":{if(a.__leftNum>=a._contentArray[a.__lineNum].length){if(a.__lineNum>=a._contentArray.length-1)return;a.__lineNum+=1;a.__leftNum=0}else{a.__leftNum+=1}a.$$updateCursorPosition();a.$$cancelSelect();break}case"backspace":{if(a.$$selectIsNotBlank()){a.$$deleteSelect()}else{if(a.__leftNum<=0){if(a.__lineNum<=0)return;a.__lineNum-=1;a.__leftNum=a._contentArray[a.__lineNum].length;a._contentArray[a.__lineNum]+=a._contentArray[a.__lineNum+1];a._contentArray.splice(a.__lineNum+1,1)}else{a.__leftNum-=1;a._contentArray[a.__lineNum]=a._contentArray[a.__lineNum].substring(0,a.__leftNum)+a._contentArray[a.__lineNum].substring(a.__leftNum+1)}}a.__formatData=a.$$diff(a.$shader(a._contentArray.join("\n"),a._langColors));a.$$updateCursorPosition();a.$$updateView();a.$$cancelSelect();a.__updated__();break}}})}var O=function e(t,r){if(t.length!=r.length)return false;for(var n=0;n<t.length;n++){if(t[n].content!=r[n].content||t[n].color!=r[n].color)return false}return true};function j(e){var t=this.__formatData;if(t){var r=0;for(var n=0;n<t.length&&n<e.length;n++){if(!O(t[n],e[n])){break}r+=1}var o=0;for(var i=1;i<=t.length&&i<=e.length;i++){if(!O(t[t.length-i],e[e.length-i])){break}o+=1}if(r+o>this.__formatData.length){o=this.__formatData.length-r}this.__diff={beginNum:r,endNum:o}}return e}function k(e){var t="";for(var r=0;r<this._tabSpace;r++){t+=" "}return e.replace(/\t/g,t)}function S(e){var n=[[]],o=0;e.forEach(function(e){var t=e.content.split(/\n/);n[o].push({color:e.color,content:t[0]});for(var r=1;r<t.length;r++){o+=1;n.push([]);n[o].push({color:e.color,content:t[r]})}});return n}function T(e){var o="";for(var t=0;t<e;t++){o+=" "}return function e(t){var r="";for(var n=0;n<t;n++){r+=o}return r}}function C(r,t,e){var n=[];var o=0;var i=function e(t){return r.substring(o,t+o>r.length?r.length:t+o)};var a="";var l="tag";var u=function e(){if(a!=""){n.push({color:t[l],content:a})}a=""};while(true){if(i(2)=="/*"){u();while(i(2)!=="*/"&&o<r.length){a+=r[o++]}n.push({color:t.annotation,content:a+i(2)});o+=2;a=""}else if(["'",'"'].indexOf(i(1))>-1){var c=i(1);u();do{a+=r[o++]}while(i(1)!=c&&o<r.length);if(i(1)!=c){c=""}else{o+=1}n.push({color:t.string,content:a+c});a=""}else if([":","{","}",";"].indexOf(i(1))>-1){u();n.push({color:t.border,content:i(1)});a="";if(i(1)=="{"||i(1)==";"){l="attr"}else if(i(1)=="}"){l="tag"}else{l="string"}o+=1}else{if(o>=r.length){u();break}else{a+=r[o++]}}}return e?n:S(n)}var P=["abstract","arguments","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","eval","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield"];function D(r,t,e){var n=[];var o=0;var i=function e(t){return r.substring(o,t+o>r.length?r.length:t+o)};var a="";var l=function e(){if(a!=""){if(a[0]=="("){n.push({color:t.border,content:"("});a=a.substr(1)}n.push({color:t.text,content:a})}a=""};while(true){if(i(2)=="/*"){l();while(i(2)!=="*/"&&o<r.length){a+=r[o++]}n.push({color:t.annotation,content:a+i(2)});o+=2;a=""}else if(i(2)=="//"){l();while(i(1)!=="\n"&&o<r.length){a+=r[o++]}n.push({color:t.annotation,content:a});a=""}else if(["'",'"',"`"].indexOf(i(1))>-1){var u=i(1);l();do{a+=r[o++]}while(i(1)!=u&&o<r.length);if(i(1)!=u){u=""}else{o+=1}n.push({color:t.string,content:a+u});a=""}else if(i(1)=="("&&(a[0]==" "||o-a.length-1>=0&&r[o-a.length-1]==" ")){n.push({color:t.tag,content:a});o+=1;a="("}else if(i(1)=="("){n.push({color:t.attr,content:a});o+=1;a="("}else if([";","{","}","(",")",".","\n","=","+",">","<","[","]","-","*","/","^","*","!"].indexOf(i(1))>-1){l();n.push({color:t.border,content:i(1)});a="";o+=1}else if(i(1)==" "&&P.indexOf(a.trim())>-1){n.push({color:t.key,content:a+" "});a="";o+=1}else{if(o>=r.length){l();break}else{a+=r[o++]}}}return e?n:S(n)}function E(r,n){var o=[];var i=0;var a=function e(t){return r.substring(i,t+i>r.length?r.length:t+i)};var l="";var e=function e(){if(l!=""){o.push({color:n.text,content:l})}l=""};var t=function e(){var t=" ";if(a(1)=='"')t='"';if(a(1)=="'")t="'";do{l+=r[i++]}while(a(1)!=t&&i<r.length);if(t!=" "&&i<r.length){l+=t;i+=1}o.push({color:n.string,content:l});l=""};while(true){if(a(4)=="\x3c!--"){e();while(a(3)!=="--\x3e"&&i<r.length){l+=r[i++]}o.push({color:n.annotation,content:l+a(3)});i+=3;l=""}else if(a(2)=="</"){e();o.push({color:n.border,content:"</"});i+=2;while(a(1)!==">"&&i<r.length){l+=r[i++]}if(l!=""){o.push({color:n.tag,content:l});l="";if(i<r.length){o.push({color:n.border,content:">"});i+=1}}}else if(a(1)=="<"&&a(2)!="< "){var u="";e();o.push({color:n.border,content:"<"});i+=1;while(a(1)!=">"&&a(1)!=" "&&i<r.length){l+=r[i++]}if(l!=""){if(l=="style"||l=="script"){u="</"+l+">"}o.push({color:n.tag,content:l});l="";if(i<r.length){while(i<r.length){if(a(1)==">"){e();o.push({color:n.border,content:">"});i+=1;break}else if(a(1)!=" "){e();if(a(1)!='"'&&a(1)!="'"){while(a(1)!="="&&a(1)!=">"&&i<r.length&&a(1)!=" "){l+=r[i++]}if(l!=""){o.push({color:n.attr,content:l});l="";if(a(1)=="="){o.push({color:n.text,content:"="});i+=1;if(i<r.length&&a(1)!=" "&&a(1)!=">"){t()}}}else{l+=r[i++]}}else if(a(1)=="="){o.push({color:n.text,content:"="});i+=1}else{if(i<r.length&&a(1)!=" "&&a(1)!=">"){t()}}}else{l+=r[i++]}}}}if(u!=""){var c=i,s=l;while(a(u.length)!=u&&i<r.length){l+=r[i++]}if(i<r.length){var f={"</style>":C,"<\/script>":D}[u](l,n,true);f.forEach(function(e){o.push(e)});l=""}else{l=s;i=c}}}else{if(i>=r.length){e();break}else{l+=r[i++]}}}return S(o)}var M={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/};function W(e,t){return t={exports:{}},e(t,t.exports),t.exports}var I=W(function(ce){function se(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function n(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function fe(e,t,r){if(n()){fe=Reflect.construct}else{fe=function e(t,r,n){var o=[null];o.push.apply(o,r);var i=Function.bind.apply(t,o);var a=new i;if(n)l(a,n.prototype);return a}}return fe.apply(null,arguments)}function l(e,t){l=Object.setPrototypeOf||function e(t,r){t.__proto__=r;return t};return l(e,t)}function _e(e){return o(e)||r(e)||t()}function t(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function r(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function o(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++){r[t]=e[t]}return r}}function he(e){if(typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"){he=function e(t){return _typeof2(t)}}else{he=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof2(t)}}return he(e)}(function(){var e;var t=9007199254740991;function n(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=t}function u(e){return e!=null&&typeof e!="function"&&n(e.length)}var r=Object.prototype.toString;function o(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return r.call(e)}function a(e){var t=he(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&o(e)==="[object String]"}function l(e){return u(e)&&!a(e)}var i=function e(t,r){if(!l(r)){return t.push(r)}for(var n=0;n<r.length;n++){if(l(r[n])){if(r[n].length>1){e(t,r[n])}else if(r[n].length===1){e(t,r[n][0])}}else{t.push(r[n])}}};function c(){var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}var r=[];i(r,e);return r}function s(e,t){return e===t||e!==e&&t!==t}function f(e,t,r){if(!u(e)){return-1}if(!n(r)||r<0){r=0}for(;r<e.length;r++){if(s(e[r],t)){return r}}return-1}function _(e,t,r){if(!u(e)){return-1}if(!n(r)||r>e.length-1){r=e.length-1}for(;r>-1;r--){if(s(e[r],t)){return r}}return-1}function h(e){if(!l(e)){return e}if(e.length===0){return[]}if(e.length===1){return[e[0]]}var t=[],r=fe(Array,_e(e));while(r.length>0){t.push(r[0]);var n=r[0],o=-1;for(var i=1;i<r.length;i++){if(!s(n,r[i])){r[o+1]=r[i];o+=1}}r.length=o+1}return t}function p(e){var t=he(e);return t==="symbol"||t==="object"&&e!==null&&o(e)==="[object Symbol]"}var d=Symbol.prototype.toString;var m=Object.prototype.hasOwnProperty;var g=1/0;function y(e){if(e==null){return""}if(typeof e==="string"){return e}if(a(e)){return e+""}if(Array.isArray(e)){var t=[];for(var r=0;r<e.length;r++){t[r]=y(e[r])}return"[".concat(t,"]")}if(p(e)){return d?d.call(e):""}var n="";for(var o in e){if(m.call(e,o))n+=',"'+y(o)+'":'+y(e[o])}if(n!==""){n=n.replace(/^,/,"");return"{"+n+"}"}var i="".concat(e);return i==="0"&&1/e===-g?"-0":i}function v(e,t){if(t){return l(e)}return Array.isArray(e)}function b(e){var t=he(e);return e!=null&&(t==="object"||t==="function")}function N(e){return e===true||e===false||e!==null&&he(e)==="object"&&o(e)==="[object Boolean]"}function $(e){if(e===null||he(e)!=="object"||o(e)!="[object Object]"){return false}if(Object.getPrototypeOf(e)===null){return true}var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}function w(e){return e!==null&&he(e)==="object"&&(e.nodeType===1||e.nodeType===9||e.nodeType===11)&&!$(e)}function x(e){return e!==null&&he(e)==="object"&&e.nodeType===3&&!$(e)}function A(e){if(!b(e)){return false}var t=o(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function O(e){if(e===null||he(e)!=="object"){return false}var t=o(e);return t==="[object Error]"||t==="[object DOMException]"||typeof e.message==="string"&&typeof e.name==="string"&&!$(e)}function j(e){return e===null}function k(e){return typeof e==="number"||e!==null&&he(e)==="object"&&o(e)==="[object Number]"}function S(e){return e===undefined}function T(e,t){if(!u(e)||e.length<1){return undefined}if(t){var r=0,n=t(e[0],0),o;for(var i=1;i<e.length;i++){o=t(e[i],i);if(o>n){n=o;r=i}}return e[r]}else{var a=0;for(var l=1;l<e.length;l++){if(e[l]>e[a]){a=l}}return e[a]}}function C(e,t){if(!u(e)||e.length<1){return undefined}if(t){var r=0,n=t(e[0],0),o;for(var i=1;i<e.length;i++){o=t(e[i],i);if(o<n){n=o;r=i}}return e[r]}else{var a=0;for(var l=1;l<e.length;l++){if(e[l]<e[a]){a=l}}return e[a]}}function P(e,t){if(Array.isArray(e)){return false}var r=he(e);if(r=="number"||r=="boolean"||e==null||p(e)){return true}return t!==null&&e in Object(t)||/^\w*$/.test(e)}function D(e){return e.replace(/\[/g,".").replace(/\]/g,"").replace(/"/g,"").replace(/'/g,"").split(".")}function E(e,t){if(Array.isArray(e)){return e}return P(e,t)?[e]:D(e)}var M=1/0;function W(e){if(typeof e==="string"||p(e)){return e}var t="".concat(e);return t==="0"&&1/e===-M?"-0":t}function I(e,t){t=E(t,e);var r=0;for(;r<t.length&&e!==null;r++){e=e[W(t[r])]}return r&&r===t.length?e:undefined}function L(e,t,r){var n=e==null?undefined:I(e,t);return n===undefined?r:n}function V(e,t,r){if(t=="__proto__"){Object.defineProperty(e,t,{configurable:true,enumerable:true,value:r,writable:true})}else{e[t]=r}}function F(e,t,r){V(e,t,r)}function R(e,t,r,n){if(!b(e)){return e}t=E(t,e);var o=e;for(var i=0;i<t.length;i++){var a=W(t[i]);var l=r;if(i+1!=t.length){var u=o[a];if(!b(u)){l=n?n(u,a,o):undefined;if(l===undefined){l={}}}else{l=u}}F(o,a,l);o=o[a]}return e}function B(e,t,r,n){n=typeof n==="function"?n:undefined;return e==null?e:R(e,t,r,n)}function z(e,t){e=y(e);var r=[],n=e.split(t);for(var o=0;o<n.length;o++){n[o]=n[o].trim();if(n[o]!=""){r.push(n[o])}}return r}var H=[];var U=13;var Y=400;var K=null;function q(t,e,r){var u={timer:function e(t,r,n){if(!t){throw new Error("Tick is required!")}r=r||Y;var o=(new Date).valueOf()+"_"+(Math.random()*1e3).toFixed(0);H.push({id:o,createTime:new Date,tick:t,duration:r,callback:n});u.start();return o},start:function e(){if(!K){K=setInterval(u.tick,U)}},tick:function e(){var t,r,e,n,o,i,a,l=H;H=[];H.length=0;for(r=0;r<l.length;r++){o=l[r];t=o.createTime;e=o.tick;i=o.duration;n=o.callback;a=(+new Date-t)/i;a=a>1?1:a;e(a);if(a<1&&o.id){H.push(o)}else if(n){n(a)}}if(H.length<=0){u.stop()}},stop:function e(){if(K){clearInterval(K);K=null}}};var n=u.timer(function(e){t(e)},e,r);return function(){var e;for(e in H){if(H[e].id==n){H[e].id=undefined;return}}}}function X(e,t){for(var r in t){try{e[r]=t[r]}catch(e){throw new Error("Illegal property value！")}}return e}function J(u){u=X({u:.5},u);var c,s,f;var _=function e(t){if(c){var r=(t-s)/(f-s),n=r*r,o=r*n;var i=o*c[0]+n*c[1]+r*c[2]+c[3];return i*(f-s)}else throw new Error("You shoud first set the position!")};_.setP=function(e,t,r,n,o,i){if(e<r){s=e;f=r;var a=u.u*o,l=u.u*i;t/=r-e;n/=r-e;c=[2*t-2*n+a+l,3*n-3*t-2*a-l,a,t]}else throw new Error("The point x-position should be increamented!");return _};return _}var G=(e={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear"},se(e,"45","insert"),se(e,19,"pause"),se(e,112,"f1"),se(e,113,"f2"),se(e,114,"f3"),se(e,115,"f4"),se(e,116,"f5"),se(e,117,"f6"),se(e,118,"f7"),se(e,119,"f8"),se(e,120,"f9"),se(e,121,"f10"),se(e,122,"f11"),se(e,123,"f12"),se(e,189,["-","_"]),se(e,187,["=","+"]),se(e,219,["[","{"]),se(e,221,["]","}"]),se(e,220,["\\","|"]),se(e,186,[";",":"]),se(e,222,["'",'"']),se(e,188,[",","<"]),se(e,190,[".",">"]),se(e,191,["/","?"]),se(e,192,["`","~"]),e);var Q=["shift","ctrl","alt"];function Z(e){e=e||window.event;var t=e.keyCode||e.which;var r=G[t]||t;if(!r)return;if(r.constructor!==Array)r=[r,r];var n=e.shiftKey?"shift+":"",o=e.altKey?"alt+":"",i=e.ctrlKey?"ctrl+":"";var a="",l=i+n+o;if(Q.indexOf(r[0])>=0){r[0]=r[1]=""}var u=e.code=="Key"+e.key&&!n;a=l+(l==""&&u?r[1]:r[0]);if(r[0]==""){a=a.replace(/\+$/,"")}return a}function ee(e,t,r,n){n=n||0;var o=Math.sqrt(t*t+r*r+n*n);return[1,0,0,0,0,1,0,0,0,0,1,0,t*e/o,r*e/o,n*e/o,1]}function te(e){var t=Math.sin(e),r=Math.cos(e);return[r,t,0,0,-t,r,0,0,0,0,1,0,0,0,0,1]}function re(e,t,r,n,o,i){n=n||0;o=o||0;i=i||0;return[e,0,0,0,0,t,0,0,0,0,r,0,n-n*e,o-o*t,i-i*r,1]}function ne(e,t,r,n,o,i){if(typeof e==="number"&&typeof t==="number"){if(typeof r!=="number"){r=0;n=e;o=t;i=1}else if(typeof n!=="number"||typeof o!=="number"||typeof i!=="number"){n=e;o=t;i=r;e=0;t=0;r=0}if(e==n&&t==o&&r==i)throw new Error("It's not a legitimate ray!");var a=Math.sqrt((n-e)*(n-e)+(o-t)*(o-t)),l=a!=0?(o-t)/a:1,u=a!=0?(n-e)/a:0,c=(n-e)*u+(o-t)*l,s=i-r,f=Math.sqrt(c*c+s*s),_=f!=0?s/f:1,h=f!=0?c/f:0;return[[l,_*u,u*h,0,-u,l*_,l*h,0,0,-h,_,0,t*u-e*l,r*h-e*u*_-t*l*_,-e*u*h-t*l*h-r*_,1],[l,-u,0,0,_*u,_*l,-h,0,u*h,l*h,_,0,e,t,r,1]]}else{throw new Error("a1 and b1 is required!")}}var oe=function e(t,r){var n=[];for(var o=0;o<4;o++){for(var i=0;i<r.length/4;i++){n[i*4+o]=t[o]*r[i*4]+t[o+4]*r[i*4+1]+t[o+8]*r[i*4+2]+t[o+12]*r[i*4+3]}}return n};function ie(e){var c=e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var s={move:function e(t,r,n,o){c=oe(ee(t,r,n,o),c);return s},rotate:function e(t,r,n,o,i,a,l){var u=ne(r,n,o,i,a,l);c=oe(oe(oe(u[1],te(t)),u[0]),c);return s},scale:function e(t,r,n,o,i,a){c=oe(re(t,r,n,o,i,a),c);return s},multiply:function e(t,r){c=r?oe(c,t):oe(t,c);return s},use:function e(t,r,n,o){n=n||0;o=o||1;var i=oe(c,[t,r,n,o]);i[0]=+i[0].toFixed(7);i[1]=+i[1].toFixed(7);i[2]=+i[2].toFixed(7);i[3]=+i[3].toFixed(7);return i},value:function e(){return c}};return s}function ae(e){var u=e||{},c,n;var o=function e(){var a=[],l=0,u=0;(function e(t,r){if(r>u)u=r;var n;for(n=0;n<t.children.length;n++){e(c[t.children[n]],r+1)}c[t.id].left=r+.5;if(n==0){if(a[r]==undefined)a[r]=-.5;if(a[r-1]==undefined)a[r-1]=-.5;c[t.id].top=a[r]+1;var o=a[r]+1+(c[t.pid].children.length-1)*.5;if(o-1<a[r-1])c[t.id].top=a[r-1]+1-(c[t.pid].children.length-1)*.5}else{c[t.id].top=(c[t.children[0]].top+c[t.children[n-1]].top)*.5}if(c[t.id].top<=a[r]){var i=a[r]+1-c[t.id].top;(function e(t,r){c[t].top+=i;if(a[r]<c[t].top)a[r]=c[t].top;var n;for(n=0;n<c[t].children.length;n++){e(c[t].children[n],r+1)}})(t.id,r)}a[r]=c[t.id].top;if(c[t.id].top+.5>l)l=c[t.id].top+.5})(c[n],0);return{node:c,root:n,size:l,deep:u+1}};var i=function e(i){var a={};var t=u.root(i),l,r;l=r=u.id(t);a[l]={data:t,pid:null,id:l,children:[]};(function e(t,r){var n=u.child(t,i),o;for(o=0;n&&o<n.length;o++){l=u.id(n[o]);a[r].children.push(l);a[l]={data:n[o],pid:r,id:l,children:[]};e(n[o],l)}})(t,l);return[r,a]};var t=function e(t){var r=i(t);c=r[1];n=r[0];return o()};t.root=function(e){u.root=e;return t};t.child=function(e){u.child=e;return t};t.id=function(e){u.id=e;return t};return t}var le={concat:c,indexOf:f,lastIndexOf:_,unique:h,eq:s,toString:y,isObject:b,isSymbol:p,isString:a,isBoolean:N,isElement:w,isText:x,isFunction:A,isError:O,isNull:j,isNumber:k,isUndefined:S,isArray:v,max:T,min:C,get:L,set:B,split:z,animation:q,Hermite:J,keyString:Z,Matrix4:ie,tree:ae};if(he(ce)==="object"&&he(ce.exports)==="object"){ce.exports=le}else{var ue=window.__;le.noConflict=function(e){if(window.__===le){window.__=ue}return le};window.__=le}})()});var L=M.blanksReg;var V=function e(i){var a={},l=0;i=i.trim();var t=function e(){var t="",r="";for(;l<i.length;l++){if(L.test(i[l])||l==i.length-1){t+=i[l];if(!L.test(t)){a[t.trim()]=""}l+=1;break}else if(i[l]=="="){l+=1;var n=null,o=-1;if(i.substr(l,1)=='"'||i.substr(l,1)=="'"){n=i.substr(l,1);o=1;l+=1}else if(i.substr(l,2)=='"'||i.substr(l,2)=="'"){n=i.substr(l,2);o=2;l+=2}if(n!==null){for(;l<i.length;l++){if(i.substr(l,o)==n){a[t.trim()]=r.trim();l+=2;break}else{r+=i[l]}}}else{for(;l<i.length;l++){if(L.test(i[l])){a[t.trim()]=r.trim();l+=1;break}else{r+=i[l]}}}break}else{t+=i[l]}}if(l<i.length){e()}};t();return a};var F=M.blankReg,R=M.blanksReg;var B=function e(c){var s=-1,f=null;var _=false,h="";var p=["script","pre","style","code"];var d=function e(){f=s++<c.length-1?c[s]:null;return f};var m=function e(t){return c.substring(s,t+s>c.length?c.length:t+s)};d();while(F.test(f)&&s<c.length-1){d()}return function(){var e=f,t={};if(e==null)return null;if(_){t.type="textcode";t.tagName=e;while(m(h.length+3)!="</"+h+">"&&s<c.length){t.tagName+=d()}t.tagName=t.tagName.replace(/<$/,"");_=false;return t}if(m(4)=="\x3c!--"){t.type="comment";t.tagName=e;while(m(3)!="--\x3e"&&s<c.length){t.tagName+=d()}d();d();d();t.tagName=t.tagName.replace(/^<!--/,"").replace(/-$/,"");return t}if(m(9)=="<!DOCTYPE"){t.type="DOCTYPE";t.tagName=e;while(m(1)!=">"&&s<c.length){t.tagName+=d()}d();t.tagName=t.tagName.replace(/^<!DOCTYPE/,"").replace(/>$/,"");return t}else if(e=="<"){var r=false,n=null,o=null;while(r||f!=">"&&s<c.length){e+=d();if(r){var i=m(o+1).substring(1);if(i==n){r=false}}else{var a=m(2);if(a=='="'||a=="='"){n=a.replace("=","");o=1;r=true}a=m(3);if(a=='="'||a=="='"){n=a.replace("=","");o=2;r=true}}}if(/^<\//.test(e)){t.tagName=e.replace(/^<\//,"").replace(/>$/,"");t.type="endTag"}else{if(/\/>$/.test(e)){t.type="fullTag";e=e.replace(/\/>$/,"")}else{t.type="beginTag";e=e.replace(/>$/,"")}e=e.replace(/^</,"");t.tagName="";var l=0;for(;l<e.length;l++){if(e[l]==" ")break;t.tagName+=e[l]}var u=e.substring(l);if(R.test(u)){t.attrs={}}else{t.attrs=V(u)}}}else{t.type="textcode";t.tagName=f;while(m(1)!="<"&&s<c.length){t.tagName+=d()}t.tagName=t.tagName.replace(/<$/,"");s-=1}if(t.type=="beginTag"){if(p.indexOf(t.tagName.toLowerCase())>-1){_=true;h=t.tagName}}else if(t.type=="endTag"){if(p.indexOf(t.tagName.toLowerCase())>-1){_=false}}d();return t}};var z=function e(t){t=H(t);var r=0,n=[];t.forEach(function(e){if(e.type=="beginTag"){n.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:++r,__tagType__:"double"})}else if(e.type=="endTag"){r-=1}else if(e.type=="textcode"){n.push({type:"text",content:e.tagName,__deep__:r+1})}else if(e.type=="comment"){n.push({type:"comment",content:e.tagName,__deep__:r+1})}else{n.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:r+1,__tagType__:"single"})}});return n};var H=function e(n){var o=[];n.forEach(function(e,t){if(e.type=="beginTag"){o.push([t,e.tagName])}else if(e.type=="endTag"){while(o.length>0){var r=o.pop();if(r[1]==e.tagName){break}else{n[r[0]].type="fullTag"}}}});return n};var U=M.blanksReg;var Y=function e(t,r){if(!I.isString(t))throw new Error("Template must be a String!");var n=B(t);var o=n(),e=[];while(o!=null){if(o.type=="textcode"&&U.test(o.tagName));else if(o.type=="DOCTYPE");else if(o.type=="comment"){if(r){e.push(o)}}else{e.push(o)}o=n()}e=z(e);var i=[null],a=0;for(var l=0;l<e.length;l++){var u=l,c=e[l].__deep__;e[l].childNodes=[];e[l].preNode=null;e[l].nextNode=null;var s=i[i.length-1];var f=i.length>1?i[i.length-2]:null;if(c==a){e[u].preNode=s;e[s].nextNode=u;e[u].parentNode=f;e[f].childNodes.push(u);i[i.length-1]=u}else if(c>a){e[u].parentNode=s;if(s!=null)e[s].childNodes.push(u);i.push(u)}else{var _=i[i.length-1-(a-c)];var h=i[i.length-2-(a-c)];e[u].preNode=_;if(_!=null)e[_].nextNode=u;e[u].parentNode=h;if(h!=null)e[h].childNodes.push(u);for(var p=0;p<a-c;p++){i.pop()}i[i.length-1]=u}a=c}return e};function K(e,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=T(t);console.warn("[提醒] CSS格式化方法未提供！");return e}function q(e,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=T(t);console.warn("[提醒] JavaScript格式化方法未提供！");return e}function X(e,t){var r=Y("<help-root>"+e+"</help-root>",true);if(r[r.length-1].type=="comment"){r[r.length-1].content=r[r.length-1].content.replace(/\<\/help\-root\>null$/,"")}var n=T(t);var o=r[0].childNodes,i=0,a,l,u,c="";while(i<o.length){do{a=o[i++]}while(_(a));a=r[a];if(!a){break}if(a.type=="tag"){l="";for(var s in a.attrs){l+="".concat(s,'="').concat(a.attrs[s],'" ')}if(a.__tagType__=="double"){c=a.name;u=[];u.push(n(a.__deep__-2)+"<".concat(a.name," ").concat(l,">"));for(var f=0;f<a.childNodes.length;f++){u.push(a.childNodes[f])}u.push(n(a.__deep__-2)+"</".concat(a.name,">"));o.splice.apply(o,[i-1,1].concat(_toConsumableArray2(u)))}else{o[i-1]=n(a.__deep__-2)+"<".concat(a.name," ").concat(l,"/>")}}else if(a.type=="text"){switch(c){case"script":{o[i-1]=q(a.content.trim(),t,a.__deep__-2);break}case"style":{o[i-1]=K(a.content.trim(),t,a.__deep__-2);break}default:{o[i-1]=n(a.__deep__-2)+a.content.trim()}}}else if(a.type=="comment"){o[i-1]=n(a.__deep__-2)+"\x3c!-- "+a.content.trim()+" --\x3e"}}return o.join("\n")}function J(r,t,e){var n=[];var o=0;var i=function e(t){return r.substring(o,t+o>r.length?r.length:t+o)};var a="";var l="tag";var u=function e(){if(a!=""){n.push({color:t[l],content:a})}a=""};while(true){if(i(2)=="/*"){u();while(i(2)!=="*/"&&o<r.length){a+=r[o++]}n.push({color:t.annotation,content:a+i(2)});o+=2;a=""}else if(["'",'"'].indexOf(i(1))>-1){var c=i(1);u();do{a+=r[o++]}while(i(1)!=c&&o<r.length);if(i(1)!=c){c=""}else{o+=1}n.push({color:t.string,content:a+c});a=""}else if([":","{","}",",","[","]"].indexOf(i(1))>-1){u();n.push({color:t.border,content:i(1)});a="";if(i(1)=="{"||i(1)==","){l="attr"}else if(i(1)=="}"){l="tag"}else{l="string"}o+=1}else{if(o>=r.length){u();break}else{a+=r[o++]}}}return e?n:S(n)}function G(e,t){return JSON.stringify(JSON.parse(e),null,t)}var Q=function e(t){var r=this;if(!(this instanceof e)){throw new Error("WSCode is a constructor and should be called with the `new` keyword")}if(l(t.el)){var n={html:E,css:C,javascript:D,json:J,normal:function e(){var t=[];r._contentArray.forEach(function(e){t.push([{content:e,color:r._colorText}])});return t}};var o={html:X,css:K,javascript:q,json:G,normal:function e(t){return t}};this._el=t.el;t.color=t.color||{};this._colorBackground=t.color.background||"#d6d6e4";this._colorText=t.color.text||"#000000";this._colorNumber=t.color.number||"#888484";this._colorEdit=t.color.edit||"#eaeaf1";this._colorCursor=t.color.cursor||"#ff0000";this._colorSelect=t.color.select||"#6c6cf1";this._fontFamily=t["font-family"]||"新宋体";this._fontWeight=t["font-weight"]||600;this._tabSpace=t.tabSpace||4;var i=t.lang||{};this._langType=i.type||"normal";this._langColors=i.color||{};this._langColors.text=this._colorText;var a=function e(t,r){r=r||{};for(var n in r){t[n]=r[n]}return t};this._langColors=a({annotation:"#6a9955",border:"#ffffff",tag:"#1e50b3",attr:"#1e83b1",string:"#ac4c1e",key:"#ff0000"},this._langColors);if(["normal","html","css","javascript","json"].indexOf(this._langType)<0){console.error("[错误]配置的语言类型‘"+this._langType+"’不支持！");this._langType="normal"}this._contentArray=_(t.content)?(this.$$filterText(t.content)+"").split("\n"):[""];this.$shader=u(t.shader)?t.shader:n[this._langType];this.$format=u(t.format)?t.format:o[this._langType]}else{throw new Error("options.el is not a element!")}this.$$initDom();this.__needUpdate=true;this.__lineNum=this._contentArray.length-1;this.__leftNum=this._contentArray[this.__lineNum].length;this.__cursor1=this.__cursor2={leftNum:0,lineNum:0};this.__formatData=this.$$diff(this.$shader(this._contentArray.join("\n"),this._langColors));this.$$initView();this.$$updateView();this.$$bindEvent();this.__updated__=function(){};this.updated=function(e){r.__updated__=e};this.valueOf=function(){return r._contentArray.join("\n")};this.format=function(){r._contentArray=r.$format(r._contentArray.join("\n"),r._tabSpace).split("\n");r.__lineNum=r._contentArray.length-1;r.__leftNum=r._contentArray[r.__lineNum].length;r.__formatData=r.$$diff(r.$shader(r._contentArray.join("\n"),r._langColors));r.$$updateView();r.$$initView()}};Q.prototype.$$textWidth=i;Q.prototype.$$bestLeftNum=a;Q.prototype.$$calcCanvasXY=c;Q.prototype.$$selectIsNotBlank=s;Q.prototype.$$filterText=k;Q.prototype.$$toTemplate=f;Q.prototype.$$initDom=p;Q.prototype.$$initView=d;Q.prototype.$$updateView=m;Q.prototype.$$updateSelectView=g;Q.prototype.$$updateCursorPosition=y;Q.prototype.$$updateCanvasSize=v;Q.prototype.$$cancelSelect=b;Q.prototype.$$deleteSelect=N;Q.prototype.$$bindEvent=A;Q.prototype.$$diff=j;Q.author="心叶（yelloxing@gmail.com）";if((typeof module==="undefined"?"undefined":_typeof2(module))==="object"&&_typeof2(module.exports)==="object"){module.exports=Q}else{window.WSCode=Q}})();