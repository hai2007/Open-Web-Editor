/*!
* web Studio Code - 🎉 An Editor Used on the Browser Side.
* git+https://github.com/yelloxing/Web-Studio-Code.git
*
* author 心叶
*
* version 1.3.4
*
* build Fri May 08 2020
*
* Copyright yelloxing
* Released under the MIT license
*
* Date:Sat May 16 2020 00:34:59 GMT+0800 (GMT+08:00)
*/

"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(!t)return;if(typeof t==="string")return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(t,e)}function _iterableToArray(t){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,r=new Array(e);n<e;n++){r[n]=t[n]}return r}function _defineProperty(t,e,n){if(e in t){Object.defineProperty(t,e,{value:n,enumerable:true,configurable:true,writable:true})}else{t[e]=n}return t}function _typeof(t){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function t(e){return typeof e}}else{_typeof=function t(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(t)}(function(){"use strict";var t;var e=Object.prototype.toString;function n(t){if(t==null){return t===undefined?"[object Undefined]":"[object Null]"}return e.call(t)}function r(t){if(t===null||_typeof(t)!=="object"||n(t)!="[object Object]"){return false}if(Object.getPrototypeOf(t)===null){return true}var e=t;while(Object.getPrototypeOf(e)!==null){e=Object.getPrototypeOf(e)}return Object.getPrototypeOf(t)===e}function l(t){return t!==null&&_typeof(t)==="object"&&(t.nodeType===1||t.nodeType===9||t.nodeType===11)&&!r(t)}function a(t){var e=_typeof(t);return e==="string"||e==="object"&&t!=null&&!Array.isArray(t)&&n(t)==="[object String]"}function o(t){var e=_typeof(t);return t!=null&&(e==="object"||e==="function")}function s(t){if(!o(t)){return false}var e=n(t);return e==="[object Function]"||e==="[object AsyncFunction]"||e==="[object GeneratorFunction]"||e==="[object Proxy]"}function i(t){this.__helpDOM.innerText=t;return this.__helpDOM.offsetWidth}function _(t){var e=this._contentArray[this.__lineNum];if(t<=40)return 0;if(t-40>=this.$$textWidth(e))return e.length;var n=t-40,r=1;for(;r<e.length;r++){var o=Math.abs(t-40-this.$$textWidth(e.substr(0,r)));if(o>n)break;n=o}return r-1}function u(t,e){return{x:this.$$textWidth(this._contentArray[e].substr(0,t)),y:e*21}}var c={stopPropagation:function t(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},preventDefault:function t(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},bind:function t(e,n,r){if(window.attachEvent){e.attachEvent("on"+n,r)}else{e.addEventListener(n,r,false)}},trigger:function t(e,n){var r;if(document.createEventObject){r=document.createEventObject();e.fireEvent("on"+n,r)}else{r=document.createEvent("HTMLEvents");r.initEvent(n,true,false);e.dispatchEvent(r)}},toNode:function t(e){var n=document.createElement("div");n.innerHTML=e;var r=n.childNodes;for(var o=0;o<r.length;o++){if(l(r[o]))return r[o]}return null},appendTo:function t(e,n){var r=l(n)?n:this.toNode(n);e.appendChild(r);return r},css:function t(e,n){for(var r in n){e.style[r]=n[r]}},attr:function t(e,n){for(var r in n){e.setAttribute(r,n[r])}},position:function t(e,n){n=n||window.event;var r=e.getBoundingClientRect();if(!n||!n.clientX)throw new Error("Event is necessary!");var o={x:n.clientX-r.left+e.scrollLeft,y:n.clientY-r.top+e.scrollTop};return o}};function f(){var t=this;c.css(this._el,{"font-size":"12px",position:"relative",cursor:"text","font-family":this._fontFamily,background:this._colorBackground,overflow:"auto"});c.bind(this._el,"click",function(){t.__focusDOM.focus()});this.__helpDOM=c.appendTo(this._el,"<span></span>");c.css(this.__helpDOM,{position:"absolute","z-index":"-1","white-space":"pre",top:0,left:0,"font-weight":this._fontWeight});this.__focusDOM=c.appendTo(this._el,"<textarea></textarea>");c.css(this.__focusDOM,{position:"absolute",width:"6px","margin-top":"3px",height:"15px","line-height":"15px",resize:"none",overflow:"hidden",padding:"0",outline:"none",border:"none",background:"rgba(0,0,0,0)",color:this._colorCursor});c.attr(this.__focusDOM,{wrap:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});this.__showDOM=c.appendTo(this._el,"<div></div>");c.css(this.__showDOM,{padding:"10px 0"});this.__selectCanvas=c.appendTo(this._el,"<canvas></canvas>");c.css(this.__selectCanvas,{width:this._el.scrollWidth-40+"px",height:this._el.scrollHeight-10+"px",position:"absolute",left:"40px",top:"10px"});c.attr(this.__selectCanvas,{width:this._el.scrollWidth-40,height:this._el.scrollHeight-10})}function h(){c.css(this.__focusDOM,{left:40+this.$$textWidth(this._contentArray[this.__lineNum])+"px",top:10+this.__lineNum*21+"px"});this.__focusDOM.focus()}function p(){var r=this;var o="";this.__formatData.forEach(function(t,e){var n="";if(e==r.__lineNum){n="background-color:"+r._colorEdit}o+="<div style='min-width: fit-content;white-space: nowrap;line-height:21px;height:21px;"+n+"'>";o+="<em style='color:"+r._colorNumber+";user-select: none;display:inline-block;font-style:normal;width:35px;text-align:right;margin-right:5px;'>"+(e+1)+"</em>";t.forEach(function(t){var e=t.content;e=e.replace(/\&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");o+="<span style='user-select: none;font-weight:"+r._fontWeight+";white-space: pre;color:"+t.color+"'>"+e+"</span>"});o+="</div>"});this.__showDOM.innerHTML=o}function d(){var l=this;var a=this.__selectCanvas.getContext("2d");a.fillStyle=this._colorSelect;a.clearRect(0,0,this.__selectCanvas.scrollWidth,this.__selectCanvas.scrollHeight);var t=function t(e,n,r){var o=l.$$calcCanvasXY(e,r);var i=l.$$calcCanvasXY(n,r);a.fillRect(o.x,o.y,i.x-o.x,21)};if(this.__cursor1.lineNum==this.__cursor2.lineNum&&this.__cursor1.leftNum==this.__cursor2.leftNum)return;a.beginPath();if(this.__cursor1.lineNum==this.__cursor2.lineNum){t(this.__cursor1.leftNum,this.__cursor2.leftNum,this.__cursor1.lineNum)}else{var e,n;if(this.__cursor1.lineNum<this.__cursor2.lineNum){e=this.__cursor1;n=this.__cursor2}else{e=this.__cursor2;n=this.__cursor1}t(e.leftNum,this._contentArray[e.lineNum].length,e.lineNum);t(0,n.leftNum,n.lineNum);for(var r=e.lineNum+1;r<n.lineNum;r++){t(0,this._contentArray[r].length,r)}}}function y(t){c.css(this.__focusDOM,{top:this.__lineNum*21+10+"px",left:40+this.$$textWidth(this._contentArray[this.__lineNum].substring(0,this.__leftNum))+"px"})}var m=(t={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear"},_defineProperty(t,"45","insert"),_defineProperty(t,19,"pause"),_defineProperty(t,112,"f1"),_defineProperty(t,113,"f2"),_defineProperty(t,114,"f3"),_defineProperty(t,115,"f4"),_defineProperty(t,116,"f5"),_defineProperty(t,117,"f6"),_defineProperty(t,118,"f7"),_defineProperty(t,119,"f8"),_defineProperty(t,120,"f9"),_defineProperty(t,121,"f10"),_defineProperty(t,122,"f11"),_defineProperty(t,123,"f12"),_defineProperty(t,189,["-","_"]),_defineProperty(t,187,["=","+"]),_defineProperty(t,219,["[","{"]),_defineProperty(t,221,["]","}"]),_defineProperty(t,220,["\\","|"]),_defineProperty(t,186,[";",":"]),_defineProperty(t,222,["'",'"']),_defineProperty(t,188,[",","<"]),_defineProperty(t,190,[".",">"]),_defineProperty(t,191,["/","?"]),_defineProperty(t,192,["`","~"]),t);var b=["shift","ctrl","alt"];function v(t){t=t||window.event;var e=t.keyCode||t.which;var n=m[e]||e;if(!n)return;if(n.constructor!==Array)n=[n,n];var r=t.shiftKey?"shift+":"",o=t.altKey?"alt+":"",i=t.ctrlKey?"ctrl+":"";var l="",a=i+r+o;if(b.indexOf(n[0])>=0){n[0]=n[1]=""}var s=t.code=="Key"+t.key&&!r;l=a+(a==""&&s?n[1]:n[0]);if(n[0]==""){l=l.replace(/\+$/,"")}return l}function g(){var l=this;var e=false;var n=function t(e){var n=c.position(l._el,e);var r=Math.round((n.y-20.5)/21);if(r<0)r=0;if(r>=l._contentArray.length)r=l._contentArray.length-1;return{leftNum:l.$$bestLeftNum(n.x),lineNum:r}};c.bind(document,"mousedown",function(t){e=true;l.__cursor2=l.__cursor1=n(t);l.$$updateSelectView()});c.bind(document,"mousemove",function(t){if(!e)return;l.__cursor2=n(t);l.$$updateSelectView()});c.bind(document,"mouseup",function(){return e=false});c.bind(document,"mouseout",function(){return e=false});c.bind(this._el,"click",function(t){var e=c.position(l._el,t);var n=Math.round((e.y-20.5)/21);if(n<0||n>=l._contentArray.length)return;l.__lineNum=n;l.__leftNum=l.$$bestLeftNum(e.x);l.$$updateCursorPosition();l.$$updateView()});var r=function t(e){e=e||l.__focusDOM.value;l.__focusDOM.value="";if(/^\n$/.test(e)){if(l.__leftNum>=l._contentArray[l.__lineNum].length){l._contentArray.splice(l.__lineNum+1,0,"")}else{l._contentArray.splice(l.__lineNum+1,0,l._contentArray[l.__lineNum].substring(l.__leftNum));l._contentArray[l.__lineNum]=l._contentArray[l.__lineNum].substring(0,l.__leftNum)}l.__lineNum+=1;l.__leftNum=0}else{var n=e.split(/\n/);if(n.length<=1){l._contentArray[l.__lineNum]=l._contentArray[l.__lineNum].substring(0,l.__leftNum)+e+l._contentArray[l.__lineNum].substring(l.__leftNum);l.__leftNum+=e.length}else{var r;var o=l._contentArray[l.__lineNum].substring(0,l.__leftNum);var i=l._contentArray[l.__lineNum].substring(l.__leftNum);n[0]=o+n[0];n[n.length-1]+=i;(r=l._contentArray).splice.apply(r,[l.__lineNum,1].concat(_toConsumableArray(n)));l.__lineNum+=n.length-1;l.__leftNum=n[n.length-1].length-i.length}}l.__formatData=l.$shader(l._contentArray.join("\n"),l._langColors);l.$$updateCursorPosition();l.$$updateView()};c.bind(this.__focusDOM,"compositionstart",function(){l.__needUpdate=false;l.__focusDOM.style.color="rgba(0,0,0,0)";l.__focusDOM.style.borderLeft="1px solid "+l._colorCursor});c.bind(this.__focusDOM,"compositionend",function(){l.__needUpdate=true;l.__focusDOM.style.color=l._colorCursor;l.__focusDOM.style.borderLeft="none";r()});c.bind(this.__focusDOM,"input",function(){if(l.__needUpdate)r()});c.bind(this._el,"keydown",function(t){switch(v(t)){case"tab":{c.stopPropagation(t);c.preventDefault(t);var e="";for(var n=0;n<l._tabSpace;n++){e+=" "}r(e);break}case"up":{if(l.__lineNum<=0)return;l.__lineNum-=1;l.__leftNum=l.$$bestLeftNum(l.$$textWidth(l._contentArray[l.__lineNum+1].substr(0,l.__leftNum))+40);l.$$updateCursorPosition();l.$$updateView();l._el.scrollTop-=21;break}case"down":{if(l.__lineNum>=l._contentArray.length-1)return;l.__lineNum+=1;l.__leftNum=l.$$bestLeftNum(l.$$textWidth(l._contentArray[l.__lineNum-1].substr(0,l.__leftNum))+40);l.$$updateCursorPosition();l.$$updateView();l._el.scrollTop+=21;break}case"left":{if(l.__leftNum<=0){if(l.__lineNum<=0)return;l.__lineNum-=1;l.__leftNum=l._contentArray[l.__lineNum].length}else{l.__leftNum-=1}l.$$updateCursorPosition();break}case"right":{if(l.__leftNum>=l._contentArray[l.__lineNum].length){if(l.__lineNum>=l._contentArray.length-1)return;l.__lineNum+=1;l.__leftNum=0}else{l.__leftNum+=1}l.$$updateCursorPosition();break}case"backspace":{if(l.__leftNum<=0){if(l.__lineNum<=0)return;l.__lineNum-=1;l.__leftNum=l._contentArray[l.__lineNum].length;l._contentArray[l.__lineNum]+=l._contentArray[l.__lineNum+1];l._contentArray.splice(l.__lineNum+1,1)}else{l.__leftNum-=1;l._contentArray[l.__lineNum]=l._contentArray[l.__lineNum].substring(0,l.__leftNum)+l._contentArray[l.__lineNum].substring(l.__leftNum+1)}l.__formatData=l.$shader(l._contentArray.join("\n"),l._langColors);l.$$updateCursorPosition();l.$$updateView();break}}})}function N(t,e){return[]}function $(t){return t}function A(t,e){return[]}function w(t){return t}function x(t,e){return[]}function P(t){return t}var O=function t(e){var n=this;if(l(e.el)){var r={html:N,css:A,javascript:x,normal:function t(){var e=[];n._contentArray.forEach(function(t){e.push([{content:t,color:n._colorText}])});return e}};var o={html:$,css:w,javascript:P,normal:function t(e){return e}};this._el=e.el;e.color=e.color||{};this._colorBackground=e.color.background||"#d6d6e4";this._colorText=e.color.text||"#000000";this._colorNumber=e.color.number||"#888484";this._colorEdit=e.color.edit||"#eaeaf1";this._colorCursor=e.color.cursor||"#ff0000";this._colorSelect=e.color.select||"#6c6cf155";this._fontFamily=e["font-family"]||"新宋体";this._fontWeight=e["font-weight"]||600;this._tabSpace=e.tabSpace||4;var i=e.lang||{};this._langType=i.type||"normal";this._langColors=i.color||{};this._langColors.text=this._colorText;this._contentArray=a(e.content)?(e.content+"").split("\n"):[""];this.$shader=s(e.shader)?e.shader:r[this._langType];this.$format=s(e.format)?e.format:o[this._langType]}else{throw new Error("options.el is not a element!")}this.$$initDom();this.__needUpdate=true;this.__lineNum=this._contentArray.length-1;this.__leftNum=this._contentArray[this.__lineNum].length;this.__formatData=this.$shader(this._contentArray.join("\n"),this._langColors);this.$$initView();this.$$updateView();this.$$bindEvent();this.valueOf=function(){return n._contentArray.join("\n")};this.format=function(){n._contentArray=n.$format(n._contentArray.join("\n")).split("\n");n.__lineNum=n._contentArray.length-1;n.__leftNum=n._contentArray[n.__lineNum].length;n.__formatData=n.$shader(n._contentArray.join("\n"),n._langColors);n.$$updateView();n.$$initView()}};O.prototype.$$textWidth=i;O.prototype.$$bestLeftNum=_;O.prototype.$$calcCanvasXY=u;O.prototype.$$initDom=f;O.prototype.$$initView=h;O.prototype.$$updateView=p;O.prototype.$$updateSelectView=d;O.prototype.$$updateCursorPosition=y;O.prototype.$$bindEvent=g;O.author="心叶（yelloxing@gmail.com）";if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=O}else{window.WSCode=O}})();