/*!
* web Studio Code - 🎉 An Editor Used on the Browser Side.
* git+https://github.com/yelloxing/Web-Studio-Code.git
*
* author 心叶
*
* version 1.9.0-alpha.2
*
* build Fri May 08 2020
*
* Copyright yelloxing
* Released under the MIT license
*
* Date:Thu Jul 02 2020 15:50:41 GMT+0800 (GMT+08:00)
*/

"use strict";function _toConsumableArray2(e){return _arrayWithoutHoles2(e)||_iterableToArray2(e)||_unsupportedIterableToArray(e)||_nonIterableSpread2()}function _nonIterableSpread2(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(e,t)}function _iterableToArray2(e){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles2(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++){r[n]=e[n]}return r}function _defineProperty2(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function _typeof2(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof2=function e(t){return typeof t}}else{_typeof2=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return _typeof2(e)}(function(){"use strict";var e;if(!window.Symbol){window.Symbol=function(){console.error("\n[Web Studio Code] Symbol Unexpected!\n------------------------------------------------------------------\nhttps://github.com/yelloxing/Web-Studio-Code/issues\n\n")}}var t=Object.prototype.toString;function n(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return t.call(e)}function r(e){if(e===null||_typeof2(e)!=="object"||n(e)!="[object Object]"){return false}if(Object.getPrototypeOf(e)===null){return true}var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}function a(e){return e!==null&&_typeof2(e)==="object"&&(e.nodeType===1||e.nodeType===9||e.nodeType===11)&&!r(e)}function _(e){var t=_typeof2(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&n(e)==="[object String]"}function o(e){var t=_typeof2(e);return e!=null&&(t==="object"||t==="function")}function f(e){if(!o(e)){return false}var t=n(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function i(e){this.__helpCalcDOM.innerText=e;return this.__helpCalcDOM.offsetWidth}function l(e,t){if(arguments.length<2)t=t||this.__lineNum;var n=this._contentArray[t];if(e<=40)return 0;if(e-40>=this.$$textWidth(n))return n.length;var r=e-40,o=1;for(;o<n.length;o++){var i=Math.abs(e-40-this.$$textWidth(n.substr(0,o)));if(i>r)break;r=i}return o-1}function u(e,t){return{x:this.$$textWidth(this._contentArray[t].substr(0,e)),y:t*21}}function s(){return this.__cursor1.lineNum!=this.__cursor2.lineNum||this.__cursor1.leftNum!=this.__cursor2.leftNum}function c(e,t){var n=this;var r="";r+="<div style='min-width: fit-content;white-space: nowrap;line-height:21px;height:21px;'>";r+="<em style='color:"+this._colorNumber+";user-select: none;display:inline-block;font-style:normal;width:35px;text-align:right;margin-right:5px;'>"+(t+1)+"</em>";e.forEach(function(e){var t=e.content;t=t.replace(/\&/g,"&amp;");t=t.replace(/</g,"&lt;");t=t.replace(/>/g,"&gt;");r+="<span style='user-select: none;font-weight:"+n._fontWeight+";white-space: pre;color:"+e.color+"'>"+t+"</span>"});return r+"</div>"}function h(e){return{leftNum:e.__leftNum,lineNum:e.__lineNum,x:e.__cursorLeft,y:e.__cursorTop,lineHeight:21}}var p={stopPropagation:function e(t){t=t||window.event;if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}},preventDefault:function e(t){t=t||window.event;if(t.preventDefault){t.preventDefault()}else{t.returnValue=false}},bind:function e(t,n,r){if(window.attachEvent){t.attachEvent("on"+n,r)}else{t.addEventListener(n,r,false)}},trigger:function e(t,n){var r;if(document.createEventObject){r=document.createEventObject();t.fireEvent("on"+n,r)}else{r=document.createEvent("HTMLEvents");r.initEvent(n,true,false);t.dispatchEvent(r)}},toNode:function e(t){var n=document.createElement("div");n.innerHTML=t;var r=n.childNodes;for(var o=0;o<r.length;o++){if(a(r[o]))return r[o]}return null},appendTo:function e(t,n){var r=a(n)?n:this.toNode(n);t.appendChild(r);return r},remove:function e(t){t.parentNode.removeChild(t)},after:function e(t,n){var r=a(n)?n:this.toNode(n);t.parentNode.insertBefore(r,t.nextSibling);return r},css:function e(t,n){for(var r in n){t.style[r]=n[r]}},attr:function e(t,n){for(var r in n){t.setAttribute(r,n[r])}},position:function e(t,n){n=n||window.event;var r=t.getBoundingClientRect();if(!n||!n.clientX)throw new Error("Event is necessary!");var o={x:n.clientX-r.left+t.scrollLeft,y:n.clientY-r.top+t.scrollTop};return o},copy:function e(t){var n=this.appendTo(document.body,"<textarea>"+t+"</textarea>");n.select();try{var r=window.document.execCommand("copy",false,null);if(r){}else{}}catch(e){console.error(e)}document.body.removeChild(n)}};function d(){var t=this;this._el.innerHTML="";p.css(this._el,{"font-size":"12px",position:"relative",cursor:"text","font-family":this._fontFamily,background:this._colorBackground,overflow:"auto"});p.bind(this._el,"click",function(){setTimeout(function(){t.__focusDOM.focus()})});this.__helpCalcDOM=p.appendTo(this._el,"<span></span>");p.css(this.__helpCalcDOM,{position:"absolute","z-index":"-1","white-space":"pre",top:0,left:0,color:"rgba(0,0,0,0)","font-weight":this._fontWeight});this.__helpInputDOM=p.appendTo(this._el,"<div></div>");p.css(this.__helpInputDOM,{position:"absolute","z-index":1});p.bind(this.__helpInputDOM,"click",function(e){p.stopPropagation(e);p.preventDefault(e);t.__focusDOM.focus()});this.__focusDOM=p.appendTo(this._el,"<textarea></textarea>");p.css(this.__focusDOM,{position:"absolute",width:"6px","margin-top":"3px",height:"15px","line-height":"15px",resize:"none",overflow:"hidden",padding:"0",outline:"none",border:"none",background:"rgba(0,0,0,0)",color:this._colorCursor});p.attr(this.__focusDOM,{wrap:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});this.__showDOM=p.appendTo(this._el,"<div></div>");p.css(this.__showDOM,{padding:"10px 0"});this.__selectCanvas=p.appendTo(this._el,"<canvas></canvas>");p.css(this.__selectCanvas,{position:"absolute",left:"40px",top:"10px",opacity:"0.5"});this.$$updateCanvasSize(1,1)}function m(){p.css(this.__focusDOM,{left:40+this.$$textWidth(this._contentArray[this.__lineNum])+"px",top:10+this.__lineNum*21+"px"});this.__focusDOM.focus()}function g(){var n=this;if(this.__diff&&this.__diff.beginNum+this.__diff.endNum>10){var e=this.__showDOM.childNodes;var t=e.length;for(var r=t-this.__diff.endNum-1;r>=this.__diff.beginNum;r--){p.remove(e[r])}if(this.__diff.beginNum>0){for(var o=this.__formatData.length-1-this.__diff.endNum;o>=this.__diff.beginNum;o--){p.after(e[this.__diff.beginNum-1],this.$$toTemplate(this.__formatData[o],o))}}else{for(var i=0;i<this.__formatData.length-this.__diff.endNum;i++){p.appendTo(this.__showDOM,this.$$toTemplate(this.__formatData[i],i))}}e=this.__showDOM.childNodes;for(var l=this.__diff.beginNum;l<this.__formatData.length;l++){e[l].getElementsByTagName("em")[0].innerText=l+1}}else if(this.__diff!="not update"){var a="";this.__formatData.forEach(function(e,t){a+=n.$$toTemplate(e,t)});this.__showDOM.innerHTML=a}this.__diff="not update";if(this.__lineDom)this.__lineDom.style.backgroundColor="rgba(0, 0, 0, 0)";this.__lineDom=this.__showDOM.childNodes[this.__lineNum];this.__lineDom.style.backgroundColor=this._colorEdit}function y(){var l=this;var a=this.__selectCanvas.getContext("2d");a.fillStyle=this._colorSelect;a.clearRect(0,0,this.__selectCanvas.scrollWidth,this.__selectCanvas.scrollHeight);var e=function e(t,n,r){var o=l.$$calcCanvasXY(t,r);var i=l.$$calcCanvasXY(n,r);a.fillRect(o.x,o.y,i.x-o.x,21)};if(this.__cursor1.lineNum==this.__cursor2.lineNum&&this.__cursor1.leftNum==this.__cursor2.leftNum)return;a.beginPath();if(this.__cursor1.lineNum==this.__cursor2.lineNum){e(this.__cursor1.leftNum,this.__cursor2.leftNum,this.__cursor1.lineNum)}else{var t,n;if(this.__cursor1.lineNum<this.__cursor2.lineNum){t=this.__cursor1;n=this.__cursor2}else{t=this.__cursor2;n=this.__cursor1}e(t.leftNum,this._contentArray[t.lineNum].length,t.lineNum);e(0,n.leftNum,n.lineNum);for(var r=t.lineNum+1;r<n.lineNum;r++){e(0,this._contentArray[r].length,r)}}}function v(){this.__cursorTop=this.__lineNum*21+10;this.__cursorLeft=40+this.$$textWidth(this._contentArray[this.__lineNum].substring(0,this.__leftNum));p.css(this.__focusDOM,{top:this.__cursorTop+"px",left:this.__cursorLeft+"px"})}function b(e,t){if(arguments.length<2){e=this._el.scrollWidth-40;t=this._el.scrollHeight-10}p.css(this.__selectCanvas,{width:e+"px",height:t+"px"});p.attr(this.__selectCanvas,{width:e,height:t})}function N(){this.$$updateCanvasSize(1,1);this.__cursor1={leftNum:0,lineNum:0};this.__cursor2={leftNum:0,lineNum:0}}function $(){var e=this.__cursor2,t=this.__cursor1;if(this.__cursor1.lineNum<this.__cursor2.lineNum){e=this.__cursor1;t=this.__cursor2}else if(this.__cursor1.lineNum==this.__cursor2.lineNum){if(this.__cursor1.leftNum<this.__cursor2.leftNum){e=this.__cursor1;t=this.__cursor2}}var n=this._contentArray[e.lineNum].substr(0,e.leftNum)+this._contentArray[t.lineNum].substr(t.leftNum);this._contentArray.splice(e.lineNum,t.lineNum-e.lineNum+1,n);this.__leftNum=this.__cursor1.leftNum=this.__cursor2.leftNum=e.leftNum;this.__lineNum=this.__cursor1.lineNum=this.__cursor2.lineNum=e.lineNum;this.$$cancelSelect()}var w=(e={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear"},_defineProperty2(e,"45","insert"),_defineProperty2(e,19,"pause"),_defineProperty2(e,112,"f1"),_defineProperty2(e,113,"f2"),_defineProperty2(e,114,"f3"),_defineProperty2(e,115,"f4"),_defineProperty2(e,116,"f5"),_defineProperty2(e,117,"f6"),_defineProperty2(e,118,"f7"),_defineProperty2(e,119,"f8"),_defineProperty2(e,120,"f9"),_defineProperty2(e,121,"f10"),_defineProperty2(e,122,"f11"),_defineProperty2(e,123,"f12"),_defineProperty2(e,189,["-","_"]),_defineProperty2(e,187,["=","+"]),_defineProperty2(e,219,["[","{"]),_defineProperty2(e,221,["]","}"]),_defineProperty2(e,220,["\\","|"]),_defineProperty2(e,186,[";",":"]),_defineProperty2(e,222,["'",'"']),_defineProperty2(e,188,[",","<"]),_defineProperty2(e,190,[".",">"]),_defineProperty2(e,191,["/","?"]),_defineProperty2(e,192,["`","~"]),e);var x=["shift","ctrl","alt"];function A(e){e=e||window.event;var t=e.keyCode||e.which;var n=w[t]||t;if(!n)return;if(n.constructor!==Array)n=[n,n];var r=e.shiftKey?"shift+":"",o=e.altKey?"alt+":"",i=e.ctrlKey?"ctrl+":"";var l="",a=i+r+o;if(x.indexOf(n[0])>=0){n[0]=n[1]=""}var u=e.code=="Key"+e.key&&!r;l=a+(a==""&&u?n[1]:n[0]);if(n[0]==""){l=l.replace(/\+$/,"")}return l}function O(){var u=this;var t=false;var n=function e(t){var n=p.position(u._el,t);var r=Math.round((n.y-20.5)/21);if(r<0)r=0;if(r>=u._contentArray.length)r=u._contentArray.length-1;return{leftNum:u.$$bestLeftNum(n.x,r),lineNum:r}};var s=function e(){var t=u.__cursor2,n=u.__cursor1;if(u.__cursor1.lineNum<u.__cursor2.lineNum){t=u.__cursor1;n=u.__cursor2}else if(u.__cursor1.lineNum==u.__cursor2.lineNum){if(u.__cursor1.leftNum<u.__cursor2.leftNum){t=u.__cursor1;n=u.__cursor2}return u._contentArray[t.lineNum].substring(t.leftNum,n.leftNum)}var r="";r+=u._contentArray[t.lineNum].substr(t.leftNum)+"\n";for(var o=t.lineNum+1;o<n.lineNum;o++){r+=u._contentArray[o]+"\n"}r+=u._contentArray[n.lineNum].substr(0,n.leftNum);return r};p.bind(document,"mousedown",function(e){t=true;u.__cursor2=u.__cursor1=n(e);u.$$updateCanvasSize();u.$$updateSelectView()});p.bind(document,"mousemove",function(e){if(!t)return;u.__cursor2=n(e);u.$$updateSelectView()});p.bind(document,"mouseup",function(){return t=false});p.bind(document,"mouseout",function(){return t=false});p.bind(this._el,"click",function(e){u.__helpInputDOM.innerHTML="";var t=p.position(u._el,e);var n=Math.round((t.y-20.5)/21);if(n<0||n>=u._contentArray.length)return;u.__lineNum=n;u.__leftNum=u.$$bestLeftNum(t.x);u.$$updateCursorPosition();u.$$updateView()});var c=function e(t){t=t||u.__focusDOM.value;t=u.$$filterText(t);u.__focusDOM.value="";if(u.$$selectIsNotBlank())u.$$deleteSelect();if(/^\n$/.test(t)){if(u.__leftNum>=u._contentArray[u.__lineNum].length){u._contentArray.splice(u.__lineNum+1,0,"")}else{u._contentArray.splice(u.__lineNum+1,0,u._contentArray[u.__lineNum].substring(u.__leftNum));u._contentArray[u.__lineNum]=u._contentArray[u.__lineNum].substring(0,u.__leftNum)}u.__lineNum+=1;u.__leftNum=0}else{var n=t.split(/\n/);if(n.length<=1){u._contentArray[u.__lineNum]=u._contentArray[u.__lineNum].substring(0,u.__leftNum)+t+u._contentArray[u.__lineNum].substring(u.__leftNum);u.__leftNum+=t.length}else{var r;var o=u._contentArray[u.__lineNum].substring(0,u.__leftNum);var i=u._contentArray[u.__lineNum].substring(u.__leftNum);n[0]=o+n[0];n[n.length-1]+=i;(r=u._contentArray).splice.apply(r,[u.__lineNum,1].concat(_toConsumableArray2(n)));u.__lineNum+=n.length-1;u.__leftNum=n[n.length-1].length-i.length}}u.__formatData=u.$$diff(u.$shader(u._contentArray.join("\n"),u._langColors));u.$$updateCursorPosition();u.$$updateView();u.__updated__()};p.bind(this.__focusDOM,"compositionstart",function(){u.__needUpdate=false;u.__focusDOM.style.color="rgba(0,0,0,0)";u.__focusDOM.style.borderLeft="1px solid "+u._colorCursor});p.bind(this.__focusDOM,"compositionend",function(){u.__needUpdate=true;u.__focusDOM.style.color=u._colorCursor;u.__focusDOM.style.borderLeft="none";c();if(u.$input!=null)u.__helpInputEvent=u.$input(u.__helpInputDOM,h(u),u._contentArray)||{}});p.bind(this.__focusDOM,"input",function(){if(u.__needUpdate){c();if(u.$input!=null)u.__helpInputEvent=u.$input(u.__helpInputDOM,h(u),u._contentArray)||{}}});p.bind(this._el,"keydown",function(e){var t=A(e);if(u.__helpInputDOM.innerHTML!=""){var n=u.__helpInputEvent[t];if(f(n)){if(!n())return}else{u.__helpInputDOM.innerHTML=""}}switch(t){case"ctrl+a":{u.__cursor1={leftNum:0,lineNum:0};u.__cursor2={lineNum:u._contentArray.length-1,leftNum:u._contentArray[u._contentArray.length-1].length};u.$$updateSelectView();break}case"ctrl+c":{if(u.$$selectIsNotBlank()){p.copy(s());u.__focusDOM.focus()}break}case"ctrl+x":{if(u.$$selectIsNotBlank()){p.copy(s());u.__focusDOM.focus();u.$$deleteSelect();u.__formatData=u.$$diff(u.$shader(u._contentArray.join("\n"),u._langColors));u.$$updateCursorPosition();u.$$updateView();u.$$cancelSelect();u.__updated__()}break}case"tab":{p.stopPropagation(e);p.preventDefault(e);var r="";for(var o=0;o<u._tabSpace;o++){r+=" "}if(u.$$selectIsNotBlank()){var i=u.__cursor1.lineNum,l=u.__cursor2.lineNum;if(i>l){i=u.__cursor2.lineNum;l=u.__cursor1.lineNum}for(var a=i;a<=l;a++){u._contentArray[a]=r+u._contentArray[a]}u.__cursor1.leftNum+=u._tabSpace;u.__cursor2.leftNum+=u._tabSpace;u.__leftNum+=u._tabSpace;u.__formatData=u.$$diff(u.$shader(u._contentArray.join("\n"),u._langColors));u.$$updateCursorPosition();u.$$updateView();u.$$updateCanvasSize();u.$$updateSelectView();u.__updated__()}else{c(r)}break}case"up":{if(u.__lineNum<=0)return;u.__lineNum-=1;u.__leftNum=u.$$bestLeftNum(u.$$textWidth(u._contentArray[u.__lineNum+1].substr(0,u.__leftNum))+40);u.$$updateCursorPosition();u.$$updateView();u.$$cancelSelect();u._el.scrollTop-=21;break}case"down":{if(u.__lineNum>=u._contentArray.length-1)return;u.__lineNum+=1;u.__leftNum=u.$$bestLeftNum(u.$$textWidth(u._contentArray[u.__lineNum-1].substr(0,u.__leftNum))+40);u.$$updateCursorPosition();u.$$updateView();u.$$cancelSelect();u._el.scrollTop+=21;break}case"left":{if(u.__leftNum<=0){if(u.__lineNum<=0)return;u.__lineNum-=1;u.__leftNum=u._contentArray[u.__lineNum].length}else{u.__leftNum-=1}u.$$updateCursorPosition();u.$$cancelSelect();break}case"right":{if(u.__leftNum>=u._contentArray[u.__lineNum].length){if(u.__lineNum>=u._contentArray.length-1)return;u.__lineNum+=1;u.__leftNum=0}else{u.__leftNum+=1}u.$$updateCursorPosition();u.$$cancelSelect();break}case"backspace":{if(u.$$selectIsNotBlank()){u.$$deleteSelect()}else{if(u.__leftNum<=0){if(u.__lineNum<=0)return;u.__lineNum-=1;u.__leftNum=u._contentArray[u.__lineNum].length;u._contentArray[u.__lineNum]+=u._contentArray[u.__lineNum+1];u._contentArray.splice(u.__lineNum+1,1)}else{u.__leftNum-=1;u._contentArray[u.__lineNum]=u._contentArray[u.__lineNum].substring(0,u.__leftNum)+u._contentArray[u.__lineNum].substring(u.__leftNum+1)}}u.__formatData=u.$$diff(u.$shader(u._contentArray.join("\n"),u._langColors));u.$$updateCursorPosition();u.$$updateView();u.$$cancelSelect();u.__updated__();break}}})}var j=function e(t,n){if(t.length!=n.length)return false;for(var r=0;r<t.length;r++){if(t[r].content!=n[r].content||t[r].color!=n[r].color)return false}return true};function k(e){var t=this.__formatData;if(t){var n=0;for(var r=0;r<t.length&&r<e.length;r++){if(!j(t[r],e[r])){break}n+=1}var o=0;for(var i=1;i<=t.length&&i<=e.length;i++){if(!j(t[t.length-i],e[e.length-i])){break}o+=1}var l=Math.min(t.length,e.length);if(n+o>=l){o=l-n-1;if(o<0)o=0}this.__diff={beginNum:n,endNum:o}}return e}function T(e){var t="";for(var n=0;n<this._tabSpace;n++){t+=" "}return e.replace(/\t/g,t)}function S(e){var r=[[]],o=0;e.forEach(function(e){var t=e.content.split(/\n/);r[o].push({color:e.color,content:t[0]});for(var n=1;n<t.length;n++){o+=1;r.push([]);r[o].push({color:e.color,content:t[n]})}});return r}function D(e){var o="";for(var t=0;t<e;t++){o+=" "}return function e(t){var n="";for(var r=0;r<t;r++){n+=o}return n}}function C(n,t,e){var r=[];var o=0;var i=function e(t){return n.substring(o,t+o>n.length?n.length:t+o)};var l="";var a="tag";var u=function e(){if(l!=""){r.push({color:t[a],content:l})}l=""};while(true){if(i(2)=="/*"){u();while(i(2)!=="*/"&&o<n.length){l+=n[o++]}r.push({color:t.annotation,content:l+i(2)});o+=2;l=""}else if(["'",'"'].indexOf(i(1))>-1){var s=i(1);u();do{l+=n[o++]}while(i(1)!=s&&o<n.length);if(i(1)!=s){s=""}else{o+=1}r.push({color:t.string,content:l+s});l=""}else if([":","{","}",";"].indexOf(i(1))>-1){u();r.push({color:t.border,content:i(1)});l="";if(i(1)=="{"||i(1)==";"){a="attr"}else if(i(1)=="}"){a="tag"}else{a="string"}o+=1}else{if(o>=n.length){u();break}else{l+=n[o++]}}}return e?r:S(r)}var P=["abstract","arguments","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","eval","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield"];function M(n,t,e){var r=[];var o=0;var i=function e(t){return n.substring(o,t+o>n.length?n.length:t+o)};var l="";var a=function e(){if(l!=""){if(l[0]=="("){r.push({color:t.border,content:"("});l=l.substr(1)}r.push({color:t.text,content:l})}l=""};while(true){if(i(2)=="/*"){a();while(i(2)!=="*/"&&o<n.length){l+=n[o++]}r.push({color:t.annotation,content:l+i(2)});o+=2;l=""}else if(i(2)=="//"){a();while(i(1)!=="\n"&&o<n.length){l+=n[o++]}r.push({color:t.annotation,content:l});l=""}else if(["'",'"',"`"].indexOf(i(1))>-1){var u=i(1);a();do{l+=n[o++]}while(i(1)!=u&&o<n.length);if(i(1)!=u){u=""}else{o+=1}r.push({color:t.string,content:l+u});l=""}else if(i(1)=="("&&(l[0]==" "||o-l.length-1>=0&&n[o-l.length-1]==" ")){r.push({color:t.tag,content:l});o+=1;l="("}else if(i(1)=="("){r.push({color:t.attr,content:l});o+=1;l="("}else if([";","{","}","(",")",".","\n","=","+",">","<","[","]","-","*","/","^","*","!"].indexOf(i(1))>-1){a();r.push({color:t.border,content:i(1)});l="";o+=1}else if(i(1)==" "&&P.indexOf(l.trim())>-1){r.push({color:t.key,content:l+" "});l="";o+=1}else{if(o>=n.length){a();break}else{l+=n[o++]}}}return e?r:S(r)}function E(n,r){var o=[];var i=0;var l=function e(t){return n.substring(i,t+i>n.length?n.length:t+i)};var a="";var e=function e(){if(a!=""){o.push({color:r.text,content:a})}a=""};var t=function e(){var t=" ";if(l(1)=='"')t='"';if(l(1)=="'")t="'";do{a+=n[i++]}while(l(1)!=t&&i<n.length);if(t!=" "&&i<n.length){a+=t;i+=1}o.push({color:r.string,content:a});a=""};while(true){if(l(4)=="\x3c!--"){e();while(l(3)!=="--\x3e"&&i<n.length){a+=n[i++]}o.push({color:r.annotation,content:a+l(3)});i+=3;a=""}else if(l(2)=="</"){e();o.push({color:r.border,content:"</"});i+=2;while(l(1)!==">"&&i<n.length){a+=n[i++]}if(a!=""){o.push({color:r.tag,content:a});a="";if(i<n.length){o.push({color:r.border,content:">"});i+=1}}}else if(l(1)=="<"&&l(2)!="< "){var u="";e();o.push({color:r.border,content:"<"});i+=1;while(l(1)!=">"&&l(1)!=" "&&i<n.length){a+=n[i++]}if(a!=""){if(a=="style"||a=="script"){u="</"+a+">"}o.push({color:r.tag,content:a});a="";if(i<n.length){while(i<n.length){if(l(1)==">"){e();o.push({color:r.border,content:">"});i+=1;break}else if(l(1)!=" "){e();if(l(1)!='"'&&l(1)!="'"){while(l(1)!="="&&l(1)!=">"&&i<n.length&&l(1)!=" "){a+=n[i++]}if(a!=""){o.push({color:r.attr,content:a});a="";if(l(1)=="="){o.push({color:r.text,content:"="});i+=1;if(i<n.length&&l(1)!=" "&&l(1)!=">"){t()}}}else{a+=n[i++]}}else if(l(1)=="="){o.push({color:r.text,content:"="});i+=1}else{if(i<n.length&&l(1)!=" "&&l(1)!=">"){t()}}}else{a+=n[i++]}}}}if(u!=""){var s=i,c=a;while(l(u.length)!=u&&i<n.length){a+=n[i++]}if(i<n.length){var f={"</style>":C,"<\/script>":M}[u](a,r,true);f.forEach(function(e){o.push(e)});a=""}else{a=c;i=s}}}else{if(i>=n.length){e();break}else{a+=n[i++]}}}return S(o)}var I={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/};function L(e,t){return t={exports:{}},e(t,t.exports),t.exports}var W=L(function(se){function ce(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function r(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function fe(e,t,n){if(r()){fe=Reflect.construct}else{fe=function e(t,n,r){var o=[null];o.push.apply(o,n);var i=Function.bind.apply(t,o);var l=new i;if(r)a(l,r.prototype);return l}}return fe.apply(null,arguments)}function a(e,t){a=Object.setPrototypeOf||function e(t,n){t.__proto__=n;return t};return a(e,t)}function _e(e){return o(e)||n(e)||t()}function t(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function n(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function o(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++){n[t]=e[t]}return n}}function he(e){if(typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"){he=function e(t){return _typeof2(t)}}else{he=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof2(t)}}return he(e)}(function(){var e;var t=9007199254740991;function r(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=t}function u(e){return e!=null&&typeof e!="function"&&r(e.length)}var n=Object.prototype.toString;function o(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return n.call(e)}function l(e){var t=he(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&o(e)==="[object String]"}function a(e){return u(e)&&!l(e)}var i=function e(t,n){if(!a(n)){return t.push(n)}for(var r=0;r<n.length;r++){if(a(n[r])){if(n[r].length>1){e(t,n[r])}else if(n[r].length===1){e(t,n[r][0])}}else{t.push(n[r])}}};function s(){var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}var n=[];i(n,e);return n}function c(e,t){return e===t||e!==e&&t!==t}function f(e,t,n){if(!u(e)){return-1}if(!r(n)||n<0){n=0}for(;n<e.length;n++){if(c(e[n],t)){return n}}return-1}function _(e,t,n){if(!u(e)){return-1}if(!r(n)||n>e.length-1){n=e.length-1}for(;n>-1;n--){if(c(e[n],t)){return n}}return-1}function h(e){if(!a(e)){return e}if(e.length===0){return[]}if(e.length===1){return[e[0]]}var t=[],n=fe(Array,_e(e));while(n.length>0){t.push(n[0]);var r=n[0],o=-1;for(var i=1;i<n.length;i++){if(!c(r,n[i])){n[o+1]=n[i];o+=1}}n.length=o+1}return t}function p(e){var t=he(e);return t==="symbol"||t==="object"&&e!==null&&o(e)==="[object Symbol]"}var d=Symbol.prototype.toString;var m=Object.prototype.hasOwnProperty;var g=1/0;function y(e){if(e==null){return""}if(typeof e==="string"){return e}if(l(e)){return e+""}if(Array.isArray(e)){var t=[];for(var n=0;n<e.length;n++){t[n]=y(e[n])}return"[".concat(t,"]")}if(p(e)){return d?d.call(e):""}var r="";for(var o in e){if(m.call(e,o))r+=',"'+y(o)+'":'+y(e[o])}if(r!==""){r=r.replace(/^,/,"");return"{"+r+"}"}var i="".concat(e);return i==="0"&&1/e===-g?"-0":i}function v(e,t){if(t){return a(e)}return Array.isArray(e)}function b(e){var t=he(e);return e!=null&&(t==="object"||t==="function")}function N(e){return e===true||e===false||e!==null&&he(e)==="object"&&o(e)==="[object Boolean]"}function $(e){if(e===null||he(e)!=="object"||o(e)!="[object Object]"){return false}if(Object.getPrototypeOf(e)===null){return true}var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}function w(e){return e!==null&&he(e)==="object"&&(e.nodeType===1||e.nodeType===9||e.nodeType===11)&&!$(e)}function x(e){return e!==null&&he(e)==="object"&&e.nodeType===3&&!$(e)}function A(e){if(!b(e)){return false}var t=o(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function O(e){if(e===null||he(e)!=="object"){return false}var t=o(e);return t==="[object Error]"||t==="[object DOMException]"||typeof e.message==="string"&&typeof e.name==="string"&&!$(e)}function j(e){return e===null}function k(e){return typeof e==="number"||e!==null&&he(e)==="object"&&o(e)==="[object Number]"}function T(e){return e===undefined}function S(e,t){if(!u(e)||e.length<1){return undefined}if(t){var n=0,r=t(e[0],0),o;for(var i=1;i<e.length;i++){o=t(e[i],i);if(o>r){r=o;n=i}}return e[n]}else{var l=0;for(var a=1;a<e.length;a++){if(e[a]>e[l]){l=a}}return e[l]}}function D(e,t){if(!u(e)||e.length<1){return undefined}if(t){var n=0,r=t(e[0],0),o;for(var i=1;i<e.length;i++){o=t(e[i],i);if(o<r){r=o;n=i}}return e[n]}else{var l=0;for(var a=1;a<e.length;a++){if(e[a]<e[l]){l=a}}return e[l]}}function C(e,t){if(Array.isArray(e)){return false}var n=he(e);if(n=="number"||n=="boolean"||e==null||p(e)){return true}return t!==null&&e in Object(t)||/^\w*$/.test(e)}function P(e){return e.replace(/\[/g,".").replace(/\]/g,"").replace(/"/g,"").replace(/'/g,"").split(".")}function M(e,t){if(Array.isArray(e)){return e}return C(e,t)?[e]:P(e)}var E=1/0;function I(e){if(typeof e==="string"||p(e)){return e}var t="".concat(e);return t==="0"&&1/e===-E?"-0":t}function L(e,t){t=M(t,e);var n=0;for(;n<t.length&&e!==null;n++){e=e[I(t[n])]}return n&&n===t.length?e:undefined}function W(e,t,n){var r=e==null?undefined:L(e,t);return r===undefined?n:r}function V(e,t,n){if(t=="__proto__"){Object.defineProperty(e,t,{configurable:true,enumerable:true,value:n,writable:true})}else{e[t]=n}}function F(e,t,n){V(e,t,n)}function R(e,t,n,r){if(!b(e)){return e}t=M(t,e);var o=e;for(var i=0;i<t.length;i++){var l=I(t[i]);var a=n;if(i+1!=t.length){var u=o[l];if(!b(u)){a=r?r(u,l,o):undefined;if(a===undefined){a={}}}else{a=u}}F(o,l,a);o=o[l]}return e}function B(e,t,n,r){r=typeof r==="function"?r:undefined;return e==null?e:R(e,t,n,r)}function H(e,t){e=y(e);var n=[],r=e.split(t);for(var o=0;o<r.length;o++){r[o]=r[o].trim();if(r[o]!=""){n.push(r[o])}}return n}var z=[];var U=13;var Y=400;var K=null;function q(t,e,n){var u={timer:function e(t,n,r){if(!t){throw new Error("Tick is required!")}n=n||Y;var o=(new Date).valueOf()+"_"+(Math.random()*1e3).toFixed(0);z.push({id:o,createTime:new Date,tick:t,duration:n,callback:r});u.start();return o},start:function e(){if(!K){K=setInterval(u.tick,U)}},tick:function e(){var t,n,e,r,o,i,l,a=z;z=[];z.length=0;for(n=0;n<a.length;n++){o=a[n];t=o.createTime;e=o.tick;i=o.duration;r=o.callback;l=(+new Date-t)/i;l=l>1?1:l;e(l);if(l<1&&o.id){z.push(o)}else if(r){r(l)}}if(z.length<=0){u.stop()}},stop:function e(){if(K){clearInterval(K);K=null}}};var r=u.timer(function(e){t(e)},e,n);return function(){var e;for(e in z){if(z[e].id==r){z[e].id=undefined;return}}}}function X(e,t){for(var n in t){try{e[n]=t[n]}catch(e){throw new Error("Illegal property value！")}}return e}function J(u){u=X({u:.5},u);var s,c,f;var _=function e(t){if(s){var n=(t-c)/(f-c),r=n*n,o=n*r;var i=o*s[0]+r*s[1]+n*s[2]+s[3];return i*(f-c)}else throw new Error("You shoud first set the position!")};_.setP=function(e,t,n,r,o,i){if(e<n){c=e;f=n;var l=u.u*o,a=u.u*i;t/=n-e;r/=n-e;s=[2*t-2*r+l+a,3*r-3*t-2*l-a,l,t]}else throw new Error("The point x-position should be increamented!");return _};return _}var G=(e={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear"},ce(e,"45","insert"),ce(e,19,"pause"),ce(e,112,"f1"),ce(e,113,"f2"),ce(e,114,"f3"),ce(e,115,"f4"),ce(e,116,"f5"),ce(e,117,"f6"),ce(e,118,"f7"),ce(e,119,"f8"),ce(e,120,"f9"),ce(e,121,"f10"),ce(e,122,"f11"),ce(e,123,"f12"),ce(e,189,["-","_"]),ce(e,187,["=","+"]),ce(e,219,["[","{"]),ce(e,221,["]","}"]),ce(e,220,["\\","|"]),ce(e,186,[";",":"]),ce(e,222,["'",'"']),ce(e,188,[",","<"]),ce(e,190,[".",">"]),ce(e,191,["/","?"]),ce(e,192,["`","~"]),e);var Q=["shift","ctrl","alt"];function Z(e){e=e||window.event;var t=e.keyCode||e.which;var n=G[t]||t;if(!n)return;if(n.constructor!==Array)n=[n,n];var r=e.shiftKey?"shift+":"",o=e.altKey?"alt+":"",i=e.ctrlKey?"ctrl+":"";var l="",a=i+r+o;if(Q.indexOf(n[0])>=0){n[0]=n[1]=""}var u=e.code=="Key"+e.key&&!r;l=a+(a==""&&u?n[1]:n[0]);if(n[0]==""){l=l.replace(/\+$/,"")}return l}function ee(e,t,n,r){r=r||0;var o=Math.sqrt(t*t+n*n+r*r);return[1,0,0,0,0,1,0,0,0,0,1,0,t*e/o,n*e/o,r*e/o,1]}function te(e){var t=Math.sin(e),n=Math.cos(e);return[n,t,0,0,-t,n,0,0,0,0,1,0,0,0,0,1]}function ne(e,t,n,r,o,i){r=r||0;o=o||0;i=i||0;return[e,0,0,0,0,t,0,0,0,0,n,0,r-r*e,o-o*t,i-i*n,1]}function re(e,t,n,r,o,i){if(typeof e==="number"&&typeof t==="number"){if(typeof n!=="number"){n=0;r=e;o=t;i=1}else if(typeof r!=="number"||typeof o!=="number"||typeof i!=="number"){r=e;o=t;i=n;e=0;t=0;n=0}if(e==r&&t==o&&n==i)throw new Error("It's not a legitimate ray!");var l=Math.sqrt((r-e)*(r-e)+(o-t)*(o-t)),a=l!=0?(o-t)/l:1,u=l!=0?(r-e)/l:0,s=(r-e)*u+(o-t)*a,c=i-n,f=Math.sqrt(s*s+c*c),_=f!=0?c/f:1,h=f!=0?s/f:0;return[[a,_*u,u*h,0,-u,a*_,a*h,0,0,-h,_,0,t*u-e*a,n*h-e*u*_-t*a*_,-e*u*h-t*a*h-n*_,1],[a,-u,0,0,_*u,_*a,-h,0,u*h,a*h,_,0,e,t,n,1]]}else{throw new Error("a1 and b1 is required!")}}var oe=function e(t,n){var r=[];for(var o=0;o<4;o++){for(var i=0;i<n.length/4;i++){r[i*4+o]=t[o]*n[i*4]+t[o+4]*n[i*4+1]+t[o+8]*n[i*4+2]+t[o+12]*n[i*4+3]}}return r};function ie(e){var s=e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var c={move:function e(t,n,r,o){s=oe(ee(t,n,r,o),s);return c},rotate:function e(t,n,r,o,i,l,a){var u=re(n,r,o,i,l,a);s=oe(oe(oe(u[1],te(t)),u[0]),s);return c},scale:function e(t,n,r,o,i,l){s=oe(ne(t,n,r,o,i,l),s);return c},multiply:function e(t,n){s=n?oe(s,t):oe(t,s);return c},use:function e(t,n,r,o){r=r||0;o=o||1;var i=oe(s,[t,n,r,o]);i[0]=+i[0].toFixed(7);i[1]=+i[1].toFixed(7);i[2]=+i[2].toFixed(7);i[3]=+i[3].toFixed(7);return i},value:function e(){return s}};return c}function le(e){var u=e||{},s,r;var o=function e(){var l=[],a=0,u=0;(function e(t,n){if(n>u)u=n;var r;for(r=0;r<t.children.length;r++){e(s[t.children[r]],n+1)}s[t.id].left=n+.5;if(r==0){if(l[n]==undefined)l[n]=-.5;if(l[n-1]==undefined)l[n-1]=-.5;s[t.id].top=l[n]+1;var o=l[n]+1+(s[t.pid].children.length-1)*.5;if(o-1<l[n-1])s[t.id].top=l[n-1]+1-(s[t.pid].children.length-1)*.5}else{s[t.id].top=(s[t.children[0]].top+s[t.children[r-1]].top)*.5}if(s[t.id].top<=l[n]){var i=l[n]+1-s[t.id].top;(function e(t,n){s[t].top+=i;if(l[n]<s[t].top)l[n]=s[t].top;var r;for(r=0;r<s[t].children.length;r++){e(s[t].children[r],n+1)}})(t.id,n)}l[n]=s[t.id].top;if(s[t.id].top+.5>a)a=s[t.id].top+.5})(s[r],0);return{node:s,root:r,size:a,deep:u+1}};var i=function e(i){var l={};var t=u.root(i),a,n;a=n=u.id(t);l[a]={data:t,pid:null,id:a,children:[]};(function e(t,n){var r=u.child(t,i),o;for(o=0;r&&o<r.length;o++){a=u.id(r[o]);l[n].children.push(a);l[a]={data:r[o],pid:n,id:a,children:[]};e(r[o],a)}})(t,a);return[n,l]};var t=function e(t){var n=i(t);s=n[1];r=n[0];return o()};t.root=function(e){u.root=e;return t};t.child=function(e){u.child=e;return t};t.id=function(e){u.id=e;return t};return t}var ae={concat:s,indexOf:f,lastIndexOf:_,unique:h,eq:c,toString:y,isObject:b,isSymbol:p,isString:l,isBoolean:N,isElement:w,isText:x,isFunction:A,isError:O,isNull:j,isNumber:k,isUndefined:T,isArray:v,max:S,min:D,get:W,set:B,split:H,animation:q,Hermite:J,keyString:Z,Matrix4:ie,tree:le};if(he(se)==="object"&&he(se.exports)==="object"){se.exports=ae}else{var ue=window.__;ae.noConflict=function(e){if(window.__===ae){window.__=ue}return ae};window.__=ae}})()});var V=I.blanksReg;var F=function e(i){var l={},a=0;i=i.trim();var t=function e(){var t="",n="";for(;a<i.length;a++){if(V.test(i[a])||a==i.length-1){t+=i[a];if(!V.test(t)){l[t.trim()]=""}a+=1;break}else if(i[a]=="="){a+=1;var r=null,o=-1;if(i.substr(a,1)=='"'||i.substr(a,1)=="'"){r=i.substr(a,1);o=1;a+=1}else if(i.substr(a,2)=='"'||i.substr(a,2)=="'"){r=i.substr(a,2);o=2;a+=2}if(r!==null){for(;a<i.length;a++){if(i.substr(a,o)==r){l[t.trim()]=n.trim();a+=2;break}else{n+=i[a]}}}else{for(;a<i.length;a++){if(V.test(i[a])){l[t.trim()]=n.trim();a+=1;break}else{n+=i[a]}}}break}else{t+=i[a]}}if(a<i.length){e()}};t();return l};var R=I.blankReg,B=I.blanksReg;var H=function e(s){var c=-1,f=null;var _=false,h="";var p=["script","pre","style","code"];var d=function e(){f=c++<s.length-1?s[c]:null;return f};var m=function e(t){return s.substring(c,t+c>s.length?s.length:t+c)};d();while(R.test(f)&&c<s.length-1){d()}return function(){var e=f,t={};if(e==null)return null;if(_){t.type="textcode";t.tagName=e;while(m(h.length+3)!="</"+h+">"&&c<s.length){t.tagName+=d()}t.tagName=t.tagName.replace(/<$/,"");_=false;return t}if(m(4)=="\x3c!--"){t.type="comment";t.tagName=e;while(m(3)!="--\x3e"&&c<s.length){t.tagName+=d()}d();d();d();t.tagName=t.tagName.replace(/^<!--/,"").replace(/-$/,"");return t}if(m(9)=="<!DOCTYPE"){t.type="DOCTYPE";t.tagName=e;while(m(1)!=">"&&c<s.length){t.tagName+=d()}d();t.tagName=t.tagName.replace(/^<!DOCTYPE/,"").replace(/>$/,"");return t}else if(e=="<"){var n=false,r=null,o=null;while(n||f!=">"&&c<s.length){e+=d();if(n){var i=m(o+1).substring(1);if(i==r){n=false}}else{var l=m(2);if(l=='="'||l=="='"){r=l.replace("=","");o=1;n=true}l=m(3);if(l=='="'||l=="='"){r=l.replace("=","");o=2;n=true}}}if(/^<\//.test(e)){t.tagName=e.replace(/^<\//,"").replace(/>$/,"");t.type="endTag"}else{if(/\/>$/.test(e)){t.type="fullTag";e=e.replace(/\/>$/,"")}else{t.type="beginTag";e=e.replace(/>$/,"")}e=e.replace(/^</,"");t.tagName="";var a=0;for(;a<e.length;a++){if(e[a]==" ")break;t.tagName+=e[a]}var u=e.substring(a);if(B.test(u)){t.attrs={}}else{t.attrs=F(u)}}}else{t.type="textcode";t.tagName=f;while(m(1)!="<"&&c<s.length){t.tagName+=d()}t.tagName=t.tagName.replace(/<$/,"");c-=1}if(t.type=="beginTag"){if(p.indexOf(t.tagName.toLowerCase())>-1){_=true;h=t.tagName}}else if(t.type=="endTag"){if(p.indexOf(t.tagName.toLowerCase())>-1){_=false}}d();return t}};var z=function e(t){t=U(t);var n=0,r=[];t.forEach(function(e){if(e.type=="beginTag"){r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:++n,__tagType__:"double"})}else if(e.type=="endTag"){n-=1}else if(e.type=="textcode"){r.push({type:"text",content:e.tagName,__deep__:n+1})}else if(e.type=="comment"){r.push({type:"comment",content:e.tagName,__deep__:n+1})}else{r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:n+1,__tagType__:"single"})}});return r};var U=function e(r){var o=[];r.forEach(function(e,t){if(e.type=="beginTag"){o.push([t,e.tagName])}else if(e.type=="endTag"){while(o.length>0){var n=o.pop();if(n[1]==e.tagName){break}else{r[n[0]].type="fullTag"}}}});return r};var Y=I.blanksReg;var K=function e(t,n){if(!W.isString(t))throw new Error("Template must be a String!");var r=H(t);var o=r(),e=[];while(o!=null){if(o.type=="textcode"&&Y.test(o.tagName));else if(o.type=="DOCTYPE");else if(o.type=="comment"){if(n){e.push(o)}}else{e.push(o)}o=r()}e=z(e);var i=[null],l=0;for(var a=0;a<e.length;a++){var u=a,s=e[a].__deep__;e[a].childNodes=[];e[a].preNode=null;e[a].nextNode=null;var c=i[i.length-1];var f=i.length>1?i[i.length-2]:null;if(s==l){e[u].preNode=c;e[c].nextNode=u;e[u].parentNode=f;e[f].childNodes.push(u);i[i.length-1]=u}else if(s>l){e[u].parentNode=c;if(c!=null)e[c].childNodes.push(u);i.push(u)}else{var _=i[i.length-1-(l-s)];var h=i[i.length-2-(l-s)];e[u].preNode=_;if(_!=null)e[_].nextNode=u;e[u].parentNode=h;if(h!=null)e[h].childNodes.push(u);for(var p=0;p<l-s;p++){i.pop()}i[i.length-1]=u}l=s}return e};function q(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var r=D(t);console.warn("[提醒] CSS格式化方法未提供！");return e}function X(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var r=D(t);console.warn("[提醒] JavaScript格式化方法未提供！");return e}function J(e,t){var n=K("<help-root>"+e+"</help-root>",true);if(n[n.length-1].type=="comment"){n[n.length-1].content=n[n.length-1].content.replace(/\<\/help\-root\>null$/,"")}var r=D(t);var o=n[0].childNodes,i=0,l,a,u,s="";while(i<o.length){do{l=o[i++]}while(_(l));l=n[l];if(!l){break}if(l.type=="tag"){a="";for(var c in l.attrs){a+="".concat(c,'="').concat(l.attrs[c],'" ')}if(l.__tagType__=="double"){s=l.name;u=[];u.push(r(l.__deep__-2)+"<".concat(l.name," ").concat(a,">"));for(var f=0;f<l.childNodes.length;f++){u.push(l.childNodes[f])}u.push(r(l.__deep__-2)+"</".concat(l.name,">"));o.splice.apply(o,[i-1,1].concat(_toConsumableArray2(u)))}else{o[i-1]=r(l.__deep__-2)+"<".concat(l.name," ").concat(a,"/>")}}else if(l.type=="text"){switch(s){case"script":{o[i-1]=X(l.content.trim(),t,l.__deep__-2);break}case"style":{o[i-1]=q(l.content.trim(),t,l.__deep__-2);break}default:{o[i-1]=r(l.__deep__-2)+l.content.trim()}}}else if(l.type=="comment"){o[i-1]=r(l.__deep__-2)+"\x3c!-- "+l.content.trim()+" --\x3e"}}return o.join("\n")}function G(n,t,e){var r=[];var o=0;var i=function e(t){return n.substring(o,t+o>n.length?n.length:t+o)};var l="";var a="tag";var u=function e(){if(l!=""){r.push({color:t[a],content:l})}l=""};while(true){if(i(2)=="/*"){u();while(i(2)!=="*/"&&o<n.length){l+=n[o++]}r.push({color:t.annotation,content:l+i(2)});o+=2;l=""}else if(["'",'"'].indexOf(i(1))>-1){var s=i(1);u();do{l+=n[o++]}while(i(1)!=s&&o<n.length);if(i(1)!=s){s=""}else{o+=1}r.push({color:t.string,content:l+s});l=""}else if([":","{","}",",","[","]"].indexOf(i(1))>-1){u();r.push({color:t.border,content:i(1)});l="";if(i(1)=="{"||i(1)==","){a="attr"}else if(i(1)=="}"){a="tag"}else{a="string"}o+=1}else{if(o>=n.length){u();break}else{l+=n[o++]}}}return e?r:S(r)}function Q(e,t){return JSON.stringify(JSON.parse(e),null,t)}var Z=function e(t){var n=this;if(!(this instanceof e)){throw new Error("WSCode is a constructor and should be called with the `new` keyword")}if(a(t.el)){var r={html:E,css:C,javascript:M,json:G,normal:function e(){var t=[];n._contentArray.forEach(function(e){t.push([{content:e,color:n._colorText}])});return t}};var o={html:J,css:q,javascript:X,json:Q,normal:function e(t){return t}};this._el=t.el;t.color=t.color||{};this._colorBackground=t.color.background||"#d6d6e4";this._colorText=t.color.text||"#000000";this._colorNumber=t.color.number||"#888484";this._colorEdit=t.color.edit||"#eaeaf1";this._colorCursor=t.color.cursor||"#ff0000";this._colorSelect=t.color.select||"#6c6cf1";this._fontFamily=t["font-family"]||"新宋体";this._fontWeight=t["font-weight"]||600;this._tabSpace=t.tabSpace||4;var i=t.lang||{};this._langType=i.type||"normal";this._langColors=i.color||{};this._langColors.text=this._colorText;var l=function e(t,n){n=n||{};for(var r in n){t[r]=n[r]}return t};this._langColors=l({annotation:"#6a9955",border:"#ffffff",tag:"#1e50b3",attr:"#1e83b1",string:"#ac4c1e",key:"#ff0000"},this._langColors);if(["normal","html","css","javascript","json"].indexOf(this._langType)<0){console.error("[错误]配置的语言类型‘"+this._langType+"’不支持！");this._langType="normal"}this._contentArray=_(t.content)?(this.$$filterText(t.content)+"").split("\n"):[""];this.$shader=f(t.shader)?t.shader:r[this._langType];this.$format=f(t.format)?t.format:o[this._langType];this.$input=f(t.input)?t.input:null}else{throw new Error("options.el is not a element!")}this.$$initDom();this.__needUpdate=true;this.__lineNum=this._contentArray.length-1;this.__leftNum=this._contentArray[this.__lineNum].length;this.__cursor1=this.__cursor2={leftNum:0,lineNum:0};this.__formatData=this.$$diff(this.$shader(this._contentArray.join("\n"),this._langColors));this.$$initView();this.$$updateView();this.$$bindEvent();this.__updated__=function(){};this.updated=function(e){n.__updated__=e};this.valueOf=function(){return n._contentArray.join("\n")};this.format=function(){n._contentArray=n.$format(n._contentArray.join("\n"),n._tabSpace).split("\n");n.__lineNum=n._contentArray.length-1;n.__leftNum=n._contentArray[n.__lineNum].length;n.__formatData=n.$$diff(n.$shader(n._contentArray.join("\n"),n._langColors));n.$$updateView();n.$$initView()}};Z.prototype.$$textWidth=i;Z.prototype.$$bestLeftNum=l;Z.prototype.$$calcCanvasXY=u;Z.prototype.$$selectIsNotBlank=s;Z.prototype.$$filterText=T;Z.prototype.$$toTemplate=c;Z.prototype.$$initDom=d;Z.prototype.$$initView=m;Z.prototype.$$updateView=g;Z.prototype.$$updateSelectView=y;Z.prototype.$$updateCursorPosition=v;Z.prototype.$$updateCanvasSize=b;Z.prototype.$$cancelSelect=N;Z.prototype.$$deleteSelect=$;Z.prototype.$$bindEvent=O;Z.prototype.$$diff=k;Z.author="心叶（yelloxing@gmail.com）";if((typeof module==="undefined"?"undefined":_typeof2(module))==="object"&&_typeof2(module.exports)==="object"){module.exports=Z}else{window.WSCode=Z}})();